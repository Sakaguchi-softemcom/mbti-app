<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>16 Personalities Deep Dive</title>
<meta name="description" content="MBTIタイプの深層分析・恋愛相性・仕事相性・チーム分析">
<meta property="og:title" content="16 Personalities Deep Dive">
<meta property="og:description" content="あなたの性格を深く、美しく読み解く">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:#0a0a0f; }
  #root { min-height:100vh; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef } = React;


/* ═══════════════════════════════════════════════
   16 Personalities Deep Dive — Editorial Design
   ═══════════════════════════════════════════════ */

/* --- Font injection --- */
const _fontLink = typeof document !== "undefined" && (() => {
  if (!document.getElementById("mbti-fonts")) {
    const l = document.createElement("link");
    l.id = "mbti-fonts";
    l.rel = "stylesheet";
    l.href = "https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Noto+Sans+JP:wght@300;400;500;700;900&display=swap";
    document.head.appendChild(l);
  }
  const s = document.createElement("style");
  s.textContent = `
    @keyframes fadeUp { from { opacity:0; transform:translateY(18px) } to { opacity:1; transform:translateY(0) } }
    @keyframes glow { 0%,100%{filter:brightness(1)} 50%{filter:brightness(1.2)} }
    @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.04)} }
    @keyframes shimmer { 0%{background-position:-200% 0} 100%{background-position:200% 0} }
    @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
    * { box-sizing:border-box; }
    ::-webkit-scrollbar { width:6px } ::-webkit-scrollbar-track { background:transparent } ::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.08);border-radius:4px }
    ::selection { background:rgba(139,92,246,0.3);color:#fff }
  `;
  document.head.appendChild(s);
})();

const F = { h: "'Outfit',sans-serif", b: "'Noto Sans JP','Outfit',sans-serif" };

/* --- Avatar URLs --- */
const AV_BASE = "https://www.16personalities.com/static/images/personality-types/avatars/";
const AV_URL = {
  INTJ:AV_BASE+"intj-architect-male.svg?v=3",INTP:AV_BASE+"intp-logician-female.svg?v=3",
  ENTJ:AV_BASE+"entj-commander-female.svg?v=3",ENTP:AV_BASE+"entp-debater-male.svg?v=3",
  INFJ:AV_BASE+"infj-advocate-male.svg?v=3",INFP:AV_BASE+"infp-mediator-female.svg?v=3",
  ENFJ:AV_BASE+"enfj-protagonist-male.svg?v=3",ENFP:AV_BASE+"enfp-campaigner-female.svg?v=3",
  ISTJ:AV_BASE+"istj-logistician-male.svg?v=3",ISFJ:AV_BASE+"isfj-defender-female.svg?v=3",
  ESTJ:AV_BASE+"estj-executive-female.svg?v=3",ESFJ:AV_BASE+"esfj-consul-male.svg?v=3",
  ISTP:AV_BASE+"istp-virtuoso-male.svg?v=3",ISFP:AV_BASE+"isfp-adventurer-female.svg?v=3",
  ESTP:AV_BASE+"estp-entrepreneur-male.svg?v=3",ESFP:AV_BASE+"esfp-entertainer-female.svg?v=3"
};

/* --- Core Data --- */
const NICK = {ISTJ:"管理者",ISFJ:"擁護者",INFJ:"提唱者",INTJ:"建築家",ISTP:"巨匠",ISFP:"冒険家",INFP:"仲介者",INTP:"論理学者",ESTP:"起業家",ESFP:"エンターテイナー",ENFP:"広報運動家",ENTP:"討論者",ESTJ:"幹部",ESFJ:"領事官",ENFJ:"主人公",ENTJ:"指揮官"};
const GRP = {ISTJ:"番人",ISFJ:"番人",ESTJ:"番人",ESFJ:"番人",INFJ:"外交官",INFP:"外交官",ENFJ:"外交官",ENFP:"外交官",INTJ:"分析家",INTP:"分析家",ENTJ:"分析家",ENTP:"分析家",ISTP:"探検家",ISFP:"探検家",ESTP:"探検家",ESFP:"探検家"};
const GC = {"番人":"#4298b4","外交官":"#33b98a","分析家":"#9b6dff","探検家":"#e4ae3a"};
const EM = {ISTJ:"🏛️",ISFJ:"🛡️",INFJ:"🔮",INTJ:"♟️",ISTP:"🔧",ISFP:"🎨",INFP:"🌙",INTP:"🧪",ESTP:"🏄",ESFP:"🎉",ENFP:"🦋",ENTP:"⚡",ESTJ:"📋",ESFJ:"☀️",ENFJ:"🌟",ENTJ:"👑"};

const AVD = {
  INTJ:{bg:"#2d1b69",skin:"#c4b5fd",hair:"#1a0f40",item:"♟"},INTP:{bg:"#2d1b69",skin:"#c4b5fd",hair:"#3b1a80",item:"∞"},
  ENTJ:{bg:"#2d1b69",skin:"#c4b5fd",hair:"#1e0e50",item:"★"},ENTP:{bg:"#2d1b69",skin:"#c4b5fd",hair:"#4a2496",item:"⚡"},
  INFJ:{bg:"#0d4a3a",skin:"#6ee7b7",hair:"#083d2f",item:"◈"},INFP:{bg:"#0d4a3a",skin:"#6ee7b7",hair:"#042e22",item:"♡"},
  ENFJ:{bg:"#0d4a3a",skin:"#6ee7b7",hair:"#0b5e4a",item:"☀"},ENFP:{bg:"#0d4a3a",skin:"#6ee7b7",hair:"#14654e",item:"✿"},
  ISTJ:{bg:"#1a5276",skin:"#85c1e9",hair:"#154360",item:"▣"},ISFJ:{bg:"#1a5276",skin:"#85c1e9",hair:"#0e3348",item:"♦"},
  ESTJ:{bg:"#1a5276",skin:"#85c1e9",hair:"#1b6d96",item:"▲"},ESFJ:{bg:"#1a5276",skin:"#85c1e9",hair:"#11527a",item:"◉"},
  ISTP:{bg:"#7d6608",skin:"#f9e79f",hair:"#6e5a06",item:"⚙"},ISFP:{bg:"#7d6608",skin:"#f9e79f",hair:"#4a3c04",item:"◆"},
  ESTP:{bg:"#7d6608",skin:"#f9e79f",hair:"#8b7209",item:"➤"},ESFP:{bg:"#7d6608",skin:"#f9e79f",hair:"#5c4d05",item:"♪"}
};

const LT = {
  E:{l:"外向型 (Extraversion)",d:"外の世界との交流からエネルギーを充電する。人が多い場所で活き活きとし、会話や活動を通じて思考を整理する。行動しながら考えるタイプで、社交的な刺激を自然と求める。",c:"#f97316"},
  I:{l:"内向型 (Introversion)",d:"内面の世界からエネルギーを充電する。深い対話や一人の時間を大切にし、じっくり考えてから発言する。少人数での親密な交流を好み、静かな環境で最も力を発揮する。",c:"#818cf8"},
  S:{l:"感覚型 (Sensing)",d:"五感を通じて得た具体的な情報を信頼する。「今ここ」の現実に集中し、経験や実績に基づいて判断を下す。細部への注意力が高く、実践的で着実なアプローチを好む。",c:"#14b8a6"},
  N:{l:"直感型 (iNtuition)",d:"パターンや隠れた意味を直感的に読み取る。未来の可能性にワクワクし、抽象的なアイデアや理論を自在に操る。「もしも」の世界を想像することが得意で、革新的な発想の源泉となる。",c:"#a855f7"},
  T:{l:"思考型 (Thinking)",d:"論理と客観的な基準に基づいて意思決定を行う。感情よりも事実やデータを重視し、公平さと一貫性を大切にする。問題を構造化して分析する能力に優れ、合理的な解決策を見出す。",c:"#3b82f6"},
  F:{l:"感情型 (Feeling)",d:"価値観と人への影響を考慮して判断する。相手の気持ちに敏感で、共感力を武器に調和のとれた環境を作る。人間関係の質を重視し、一人ひとりの事情を汲み取った温かい対応ができる。",c:"#ec4899"},
  J:{l:"判断型 (Judging)",d:"計画性と秩序を好み、物事を体系的に進める。期限を守り段取りを組むのが得意で、決断を先送りにしない。目標を設定してそこに向かって着実に前進する安心感をチームに与える。",c:"#64748b"},
  P:{l:"知覚型 (Perceiving)",d:"柔軟性と臨機応変さを大切にし、選択肢を残しておくことを好む。新しい情報が入れば軌道修正を厭わない。締切間際に爆発的な集中力を発揮し、変化を楽しむ適応力がある。",c:"#eab308"}
};

/* --- Expanded Profiles --- */
const PROF = {
  ISTJ:"責任感と誠実さの象徴。一度引き受けた仕事は何があっても最後までやり遂げる。ルールと伝統を重んじ、事実に基づいた堅実な判断を下す。記憶力が非常に優れており、過去の経験やデータを正確に引き出せる。感情表現は控えめだが、大切な人への愛情は日々の行動——約束を守る、必要なものを先回りして用意する——で静かに示す。組織のバックボーンとして欠かせない存在であり、チームが安心して動ける土台を作る縁の下の力持ちでもある。",
  ISFJ:"観察力と献身性を併せ持つ、コミュニティの守り手。周囲の些細な変化——体調の揺らぎや声のトーンの違い——にいち早く気づき、さりげなくサポートする天性のケアギバー。控えめな外見とは裏腹に内面は非常に強く、自分の信じる価値観を守るためには頑として譲らない。感謝されなくても黙々と献身し続けるその姿勢は、周囲からの揺るぎない信頼を自然と集める。記念日や相手の好みを驚くほど正確に記憶しており、心のこもったサプライズで人を感動させることが多い。",
  INFJ:"全タイプ中最も稀少とされる、神秘的な洞察力の持ち主。穏やかな外見の奥に、世界をより良くしたいという強烈なビジョンと使命感を秘めている。人の本質を見抜く直感は驚くほど正確で、相手本人すら気づいていない内面の葛藤や可能性を言い当てることがある。一人ひとりとの深い対話を好み、表面的な社交には疲弊しやすい。しかし心を開いた相手に対しては、生涯を通じた深い絆と無条件の信頼を寄せる。文章表現に非凡な才能を持つ人が多い。",
  INTJ:"常に5手先を読む戦略家。独自のビジョンを実現するために、緻密な計画を設計し着実に実行する。非効率と能力不足に対して厳しく、自分自身にも極めて高い基準を課す完璧主義者。一人の時間を最も生産的に活用でき、孤独をむしろエネルギーに変える稀有な能力を持つ。感情表現は不器用だが、理解者を得ると驚くほど忠実で深い絆を築く。複雑なシステムを俯瞰してボトルネックを見抜く力は、あらゆる組織で重宝される戦略的資産となる。",
  ISTP:"「まずやってみる」の精神で生きる実践派。機械やシステムの仕組みを直感的に理解し、手を動かしながら最適解を見つけ出す天性のエンジニア。普段はクールで寡黙だが、危機的状況では誰よりも冷静沈着に対応し、その場の全員を救う行動力を見せる。束縛を何より嫌い、自分のペースと空間を侵されると途端に距離を置く。道具や技術への深い愛着があり、一つのスキルを極限まで磨き上げる職人的な集中力は他の追随を許さない。",
  ISFP:"内に豊かな感性と美意識の泉を持つ、静かなアーティスト。色・音・質感・光の微妙なニュアンスを繊細に捉え、それを独自の表現に昇華させる。言葉で自分を説明するのは苦手だが、作品や行動を通じて深い内面世界を雄弁に語る。穏やかで争いを好まない平和主義者だが、自分の核となる価値観が侵害されたと感じたときには驚くほど強い抵抗を見せる。「今この瞬間」の美しさを味わう天才であり、その在り方は周囲の人々の心にも静かな癒やしをもたらす。",
  INFP:"内面に広大な感情の宇宙を持つ理想主義者。人の痛みに深く共感し、言葉にならない感情を見事に言語化する希有な才能を持つ。現実と理想のギャップに苦しむことがあるが、その葛藤こそが類まれな創造性の源泉となっている。価値観が合う仕事や関係では120%以上の力を発揮するが、魂が共鳴しない環境では急速にエネルギーを失う。複雑な人間心理を直感的に理解する力があり、カウンセリングや物語創作の分野で特に才能を開花させることが多い。",
  INTP:"純粋な知的好奇心の化身。複雑なシステムの中に美しい法則性を見出し、「なぜ？」を無限に追求し続ける。既存の常識を疑い、独自の理論フレームワークを構築することに深い喜びを感じる。普段は物静かだが、知的な議論になると別人のように饒舌になり、鮮やかな論理展開で相手を魅了する。社交的な場は苦手だが、同じ知的レベルで対話できる相手を見つけると生涯の友となる。プログラミングや数学など、論理的思考が要求される分野で圧倒的な能力を発揮する。",
  ESTP:"「今を全力で生きる」をそのまま体現するアクションヒーロー。リスクを恐れず直感と行動力で道を切り開き、交渉の場では持ち前の心理読みとカリスマ性で相手を動かす。五感が非常に鋭く、場の空気を瞬時に読んで最適な行動を取る天性の実務家。退屈が最大の敵で、刺激のない環境ではあっという間にモチベーションを失う。しかし困難な局面や緊急事態では本領を発揮し、周囲が凍りつく場面で唯一動ける「有事の人」として頼りにされる。",
  ESFP:"場の空気を一瞬で明るくする天性のエンターテイナー。その場にいるだけで周囲の緊張が解け、自然と笑顔が広がる不思議な魅力を持つ。五感のすべてを使って「今この瞬間」を最大限に楽しみ、その喜びを惜しみなく人と分かち合う。計画より直感で動くタイプだが、人を楽しませることに関しては天才的な段取り力を発揮する。共感力も高く、悩んでいる人のそばに自然と寄り添い、明るいエネルギーで心を軽くする名カウンセラーの一面も持つ。",
  ENFP:"好奇心と情熱のスパークプラグ。新しい可能性に出会うたびに目を輝かせ、その興奮を周囲に伝染させる天性のインフルエンサー。人の隠れた才能を見抜き、その可能性を本人以上に信じて全力で応援する。アイデアの量と発想の自由度は全タイプ中トップクラスで、ブレストの場では圧倒的な存在感を放つ。反面、一つのことを最後まで完遂するのは苦手で、次の面白いことに気を取られがち。自由と自己表現を何より大切にし、型にはめられることを本能的に拒む。",
  ENTP:"知的スリルを求め続ける「悪魔の代弁者」。あらゆる角度から物事を分析し、常識を覆す鮮やかな発想で周囲を驚かせる。議論を心から楽しみ、相手の論理の穴を瞬時に見つけて突く切れ味は全タイプ随一。既存の仕組みの非合理性に我慢ならず、「壊して再構築する」ことに情熱を燃やす改革者。複雑な問題ほど目が輝き、解決策にたどり着くまでの知的冒険そのものを楽しむ。口が達者で人を惹きつけるカリスマ性があるが、感情面のケアは意識的に学ぶ必要がある。",
  ESTJ:"組織の柱として揺るぎない安定をもたらすリーダー。明確なルールと目標を設定し、チーム全員が迷わず動ける仕組みを構築する。公平で一貫性があり、約束を必ず守るその姿勢は周囲から絶大な信頼を集める。効率を追求し曖昧さを嫌うため、即断即決で物事を前に進める推進力がある。やや柔軟性に欠ける面はあるが、それは「全員が同じ基準で評価される公正な世界」を本気で実現しようとする真摯さの裏返しでもある。危機管理やプロジェクト統制で真価を発揮する。",
  ESFJ:"コミュニティの心臓部。周囲の一人ひとりの状態を細やかに把握し、必要なサポートを的確なタイミングで提供する。その場の調和を何より大切にし、全員が居心地よく過ごせる環境づくりに情熱を注ぐ。社交性と実務力を兼ね備え、イベントの企画から人間関係の調整まで幅広くこなすマルチプレイヤー。他者からの評価や感謝に敏感で、自分の献身が認められないと深く傷つくことがある。しかしその繊細さこそが、誰も気づかない小さなSOSを拾い上げる力の源泉となっている。",
  ENFJ:"生まれながらのメンター。人の内に眠る可能性を驚くほど正確に見抜き、その才能を最大限に引き出すことに心からの喜びを感じる。カリスマ性と共感力を兼ね備え、言葉と態度で人の心を動かし行動を促す天性のリーダー。一対一の深い対話を通じて人を変革する力は全タイプ中随一で、教育やコーチングの場面で圧倒的な成果を上げる。ただし他者のために尽くしすぎて自分を後回しにする傾向があり、意識的なセルフケアが長期的な活躍の鍵となる。",
  ENTJ:"天性のCEO気質。壮大なビジョンを描き、それを実現するために必要な戦略・人材・リソースを的確に配置する。論理と決断力で組織を動かし、困難な状況でも堂々と先頭に立ってチームを牽引する。効率と成果を徹底追求する一方で、有能な人材を正当に評価し引き上げる器の大きさも持つ。感情面への配慮は意識的な努力が必要だが、信頼する仲間には意外なほど誠実で面倒見が良い。長期ビジョンの策定と組織の大変革において、ENTJ以上に適任な人材は稀である。"
};

const LOV = {
  ISTJ:{s:"信頼構築型",d:"言葉よりも行動で愛を示す堅実なパートナー。約束を守ること、安定した生活基盤を築くこと、日々の責任を誠実に果たすことが最大の愛情表現。派手なロマンスは得意ではないが、長い年月をかけて揺るぎない信頼関係を構築する。一度「この人」と決めたら浮気とは無縁の一途さを持つ。",n:"安定した関係性と互いの信頼",g:"経済的安定・誠実さ・計画力",warn:"感情表現の少なさにパートナーが不安を感じることがある"},
  ISFJ:{s:"献身奉仕型",d:"相手の好み・習慣・過去の何気ない一言まで全て記憶する驚異的な記憶力の持ち主。自分の欲求よりもパートナーの幸せを優先する生粋の尽くし屋。記念日やサプライズに全力を注ぎ、日常の中に温かい「特別」を散りばめる天才。愛情の深さに比べて、自分のニーズを伝えるのは苦手。",n:"感謝の言葉と安心できる居場所",g:"無条件の愛情・細やかなケア・安定感",warn:"自己犠牲が過ぎると不満が蓄積しやすい"},
  INFJ:{s:"魂接続型",d:"表面的な恋愛には全く興味がなく、魂レベルでの深い繋がりを求める。直感で「この人だ」と確信すると心の扉を開くが、そこに至るまでのハードルは非常に高い。一度信頼したパートナーには生涯揺るがない忠誠心を捧げる。相手の心の奥底にある欲求を言葉にされる前に察知する不思議な力を持つ。",n:"精神的な深い共鳴と本音の対話",g:"洞察力・揺るがない忠誠心・精神的なサポート",warn:"理想と現実のギャップに苦しみやすい"},
  INTJ:{s:"戦略分析型",d:"恋愛さえも無意識に分析してしまう知的なパートナー。好きという感情を認めるまでに時間がかかるが、一度認識すると非常に一途。知的に対等な会話ができ、互いの成長を促し合える関係を理想とする。愛情表現は不器用だが、パートナーの人生設計を本気で一緒に考え、問題解決に全力を注ぐ。",n:"知的刺激と互いの自立を尊重する関係",g:"問題解決力・将来への計画性・揺るがない忠誠心",warn:"感情面の表現が乏しく、冷たく映ることがある"},
  ISTP:{s:"自由共存型",d:"束縛を何より嫌う自由な恋愛スタイル。好きな相手にも態度があまり変わらないクールさが特徴だが、内面では深い愛情を持っている。言葉より行動派で、パートナーが困った時に黙って駆けつけて問題を解決する姿が最大の愛情表現。互いの独立性を保ちながら並走する関係を理想とする。",n:"個人の自由と干渉しすぎない距離感",g:"いざという時の頼もしさ・実務的サポート力",warn:"感情表現が少なすぎて愛されている実感を与えにくい"},
  ISFP:{s:"感性共鳴型",d:"美しい景色・音楽・食事を共有する五感で繋がる恋愛スタイル。言葉よりも雰囲気と体験で愛を伝え、パートナーとの何気ない日常の中に芸術的な美を見出す。争いを避ける穏やかさの中に強い愛情を秘めており、パートナーの個性と自由を心から尊重する。繊細なタッチや気配りで相手をそっと包み込む。",n:"感性の共有と自由な自己表現",g:"繊細な気配り・審美眼・穏やかな癒やし",warn:"不満を溜め込みやすく、突然距離を置くことがある"},
  INFP:{s:"理想追求型",d:"心の最も深い場所で繋がれる「運命の相手」を探し続けるロマンチスト。恋愛に対して非常に豊かな想像力と期待を持ち、パートナーの中に他の誰も気づかない美しさを見出す。共感力が極めて高く、相手の痛みを自分のことのように感じ取る。理想が高い分、現実とのギャップに苦しむこともあるが、それでも諦めない純粋さが最大の魅力。",n:"精神的な深い繋がりと魂の共鳴",g:"深い共感力・無条件の受容・創造的な愛情表現",warn:"理想化しすぎて現実のパートナーに失望しやすい"},
  INTP:{s:"知的探究型",d:"恋愛を一種の知的探究として捉える独特のアプローチ。好きな人の思考パターンを無意識に分析し、理解しようとする。感情表現は極めて控えめだが、パートナーに対しては驚くほどの忠誠心と深い思いやりを持つ。知的な会話が最大のスキンシップであり、一緒に新しい発見をする喜びを分かち合えるのが理想。",n:"知的刺激と自由な思考空間の尊重",g:"独創的な視点・問題解決力・忠実さ",warn:"感情的なニーズを察するのが苦手で鈍感に映ることがある"},
  ESTP:{s:"情熱体験型",d:"一緒にいて退屈しない刺激的な恋愛を提供するアクション派。好きになったら情熱的にアプローチし、デートは常にサプライズと冒険に満ちている。行動力があり頼りがいは抜群だが、長期的なコミットメントよりも「今この瞬間の盛り上がり」を重視しがち。感情的な深い対話よりも一緒に体験を共有することで愛を深める。",n:"刺激・自由・一緒に冒険できる関係",g:"行動力・カリスマ性・楽しい時間の提供",warn:"飽きっぽさと感情的な深みの不足が課題になりやすい"},
  ESFP:{s:"全力エンジョイ型",d:"好きになったら全力でアプローチし、パートナーとの時間を最大限に楽しむ情熱家。サプライズの天才で、常に新しい楽しみを見つけてきてくれる。その場の空気を読む力に長け、パートナーが落ち込んでいる時には絶妙なタイミングで元気づける。楽しさと愛情を惜しみなく注ぐ、一緒にいて飽きない太陽のような存在。",n:"楽しさ・注目・感謝の言葉",g:"明るいエネルギー・エンタメ力・共感力",warn:"シリアスな話題を避けがちで深い対話が不足することがある"},
  ENFP:{s:"可能性探索型",d:"恋に落ちやすく、相手の可能性を誰よりも信じて全力応援する情熱家。パートナーの夢や目標に深い関心を持ち、その実現のために一緒に奔走する。新鮮さと自由を重視するため、マンネリ化した関係には息苦しさを感じる。心の深い部分で繋がりたいという欲求が強く、表面的な関係では満足できない。",n:"精神的な深い繋がりと自由な関係",g:"無限の励まし・創造的な愛情表現・人生を豊かにする発想",warn:"新しい出会いに気を取られやすく、一途さが足りないと思われることがある"},
  ENTP:{s:"知的スパーリング型",d:"知的な刺激がない恋愛は続かない。パートナーとの議論やディベートが最高のコミュニケーション。相手の知性を尊敬でき、互いに知的成長を促し合える関係を求める。ユーモアのセンスが独特で、一緒にいると笑いが絶えない。ただし感情的なケアは意識的に学ぶ必要があり、パートナーの感情面のニーズを軽視しがち。",n:"知的挑戦と新しい体験・議論できる関係",g:"ユーモア・斬新な視点・知的成長の刺激",warn:"議論が白熱して相手の感情を傷つけることがある"},
  ESTJ:{s:"計画実行型",d:"恋愛にも真面目で誠実に向き合う頼れるパートナー。将来の人生設計をしっかり立て、パートナーと共に着実にステップを踏んでいく。約束は絶対に守り、経済的にも精神的にも安定した家庭を築くことに強いコミットメントを持つ。愛情表現はロマンティックというより実務的だが、その堅実さが安心感を生む。",n:"秩序・誠実さ・互いの役割の明確さ",g:"経済的安定・計画力・揺るがない信頼性",warn:"柔軟性に欠け、パートナーの感情的ニーズを見落としやすい"},
  ESFJ:{s:"献身ケア型",d:"愛情深く世話焼きなパートナー。パートナーだけでなくその家族や友人も含めた「家族全体」を大切にする。記念日は絶対に忘れず、日常の中に温かいサプライズを散りばめる。感謝と愛情の言葉を頻繁に伝え、それと同等のリアクションを求める。コミュニティの中心として温かい人間関係のネットワークを築く天才。",n:"感謝の言葉・愛情表現・家族の調和",g:"温かいケア・社交的なサポート・安定感",warn:"過干渉になりがちで、パートナーの自由を制限してしまうことがある"},
  ENFJ:{s:"成長伴走型",d:"パートナーの夢と成長を全力でサポートする献身的なメンター型恋人。相手の可能性を誰よりも信じ、その才能を引き出すことに情熱を注ぐ。深い精神的なつながりと相互成長を理想とし、関係を通じて二人とも成長していくことを目指す。カリスマ性と包容力で相手を安心させつつ、高みへと導く。",n:"深い精神的絆と感謝の気持ち",g:"成長支援・カリスマ的包容力・深い共感",warn:"自分を犠牲にしすぎてバーンアウトすることがある"},
  ENTJ:{s:"戦略パートナー型",d:"恋愛にも明確な目標とビジョンを持つ。対等な立場で互いに高め合い、パワーカップルとして共に成功を目指す関係が理想。パートナーには知性と野心を求め、依存的な関係は好まない。リーダーシップがあり、二人の将来を力強くリードする。直接的で率直なコミュニケーションを好み、駆け引きや曖昧さは苦手。",n:"対等な関係・知的刺激・共に成長する野心",g:"リーダーシップ・決断力・経済的安定・成長支援",warn:"支配的になりがちで、パートナーの自主性を侵害することがある"}
};

const WK = {
  ISTJ:{d:"黙々と正確にタスクをこなす職人気質。マニュアルと期限を厳守し、品質の一貫性を保つ鉄壁の安定感を持つ。データと事実に基づいた意思決定を好み、曖昧な指示には苦手意識がある。組織の規律を守り、全員が同じ基準で動ける環境を整える縁の下の力持ち。",str:["正確性","責任感","時間管理","データ分析"],weak:["変化への適応","曖昧な指示への対応"],j:["会計士","品質管理","法務","公務員","銀行員","システム管理者"],bp:["ESFP","ESTP","ISFJ"],wm:"ENFP"},
  ISFJ:{d:"チームの空気を読み、メンバーのニーズを誰よりも早く察知する観察力の持ち主。地道な作業を嫌がらず、周囲が避けるような面倒な仕事も黙々とこなす。新人や困っているメンバーに自然と手を差し伸べる姿勢が、チーム全体の心理的安全性を支えている。",str:["観察力","サポート力","継続力","記憶力"],weak:["自己主張","急な変化への対応"],j:["看護師","人事","秘書","教師","社会福祉士","図書館司書"],bp:["ESFP","ESTP","ISTJ"],wm:"ENTP"},
  INFJ:{d:"静かにビジョンを描き、着実に実現する稀有な存在。大人数の会議よりも1on1で真価を発揮し、相手の本質を見抜いた上で的確なアドバイスを提供する。文章での表現力は抜群で、複雑なコンセプトを人の心に響く言葉に変換する能力が際立つ。",str:["洞察力","ビジョン","文章力","1on1コーチング"],weak:["大人数対応","自己開示","政治的駆け引き"],j:["カウンセラー","作家","教育者","UXデザイナー","心理学者","コンサルタント"],bp:["ENFP","ENTP","INTJ"],wm:"ESTP"},
  INTJ:{d:"戦略を立てて組織の効率を最大化する参謀役。独立して最高のパフォーマンスを発揮し、複雑なシステムの設計と最適化を得意とする。長期的な視野でリスクを予測し、組織が陥りがちな罠を事前に回避する先見性がある。",str:["戦略立案","分析力","効率化","システム設計"],weak:["対人コミュニケーション","チームの感情面への配慮"],j:["経営戦略","シンクタンク","プログラマー","研究職","コンサルタント","投資アナリスト"],bp:["ENFP","ENTP","INFJ"],wm:"ESFP"},
  ISTP:{d:"問題が起きた時に最も頼りになる人材。現場対応力は全タイプ随一で、複雑なトラブルを冷静に分析して最短ルートで解決する。手を動かしながら考えるタイプで、理論よりも実践から最適解を導き出す。自由度の高い環境で最も力を発揮する。",str:["問題解決","現場対応","技術力","危機管理"],weak:["ルーティンワーク","報連相の継続"],j:["エンジニア","整備士","プログラマー","消防士","パイロット","データアナリスト"],bp:["ESTJ","ENTJ","ISFP"],wm:"ENFJ"},
  ISFP:{d:"美意識と独自の感性で創造的な価値を生み出すクリエイター。既存の枠にとらわれない自由な発想が持ち味で、デザインやアートの分野で唯一無二の作品を生む。マニュアル通りの仕事よりも、自分の感性を活かせる裁量の大きい環境で輝く。",str:["創造性","美的センス","共感力","細部へのこだわり"],weak:["管理業務","長期的な計画策定"],j:["デザイナー","アーティスト","シェフ","獣医","写真家","フローリスト"],bp:["ESTJ","ENTJ","ISTP"],wm:"ENTJ"},
  INFP:{d:"理念に共感できる仕事なら120%以上の力を引き出せるが、価値観と合わない環境では急速にエネルギーを失う。「なぜこの仕事が世界に必要なのか」という意味を感じられることが、INFPにとって最大のモチベーション源。人の内面を深く理解する力を活かした対人支援の仕事で特に才能を発揮する。",str:["共感力","創造的表現","言語化力","倫理的判断"],weak:["効率重視の環境","対立状況での主張"],j:["作家","カウンセラー","NPO職員","編集者","心理士","UXライター"],bp:["ENFJ","ENTJ","INFJ"],wm:"ESTJ"},
  INTP:{d:"複雑な問題を解くこと自体が最大の喜び。「なぜ」を飽くことなく追求し、独自の理論フレームワークで問題を再定義する能力が際立つ。アイデアの質と独創性では全タイプ中トップクラスだが、実装フェーズでは他タイプのサポートが有効。知的自由が保障された環境で圧倒的な成果を出す。",str:["論理分析","革新的発想","問題の再定義","抽象的思考"],weak:["コミュニケーション","締切管理","実装の完遂"],j:["研究者","データサイエンティスト","プログラマー","ゲーム開発者","哲学者","アナリスト"],bp:["ENTJ","ENFJ","INTJ"],wm:"ESFJ"},
  ESTP:{d:"行動力で道を切り開くセールスの天才。交渉の場では持ち前の心理読みと瞬発力で相手を動かし、困難な商談も次々とまとめる。座学や理論よりも現場での実践から学ぶタイプで、スピード感のある環境で本領を発揮する。退屈なルーティンワークは天敵。",str:["交渉力","瞬発力","現場対応","リスクテイク"],weak:["デスクワーク","長期的な計画策定"],j:["営業","起業家","スポーツ関連","イベント企画","不動産","レスキュー隊"],bp:["ISFJ","ISTJ","INFJ"],wm:"INFJ"},
  ESFP:{d:"場を盛り上げるムードメーカーとして、チームの士気向上に貢献する。プレゼンテーションや接客の場面では天性の才能を発揮し、どんな相手ともすぐに打ち解ける。柔軟性が高く、予想外の状況でも即座に適応して楽しみに変える力がある。",str:["プレゼン力","ムード作り","柔軟性","対人スキル"],weak:["事務的な作業","長時間の集中"],j:["販売職","ツアーガイド","パフォーマー","広報","イベント企画","インテリアコーディネーター"],bp:["ISFJ","ISTJ","INFP"],wm:"INTJ"},
  ENFP:{d:"アイデアの量と発想の自由度は全タイプ中トップクラス。企画の初期段階ではブレスト全体を牽引する圧倒的な存在感を放つ。人の可能性を引き出し、モチベートする天性の才能があり、チームビルディングやカルチャー醸成で特に力を発揮する。",str:["発想力","モチベーション付与","人脈形成","ストーリーテリング"],weak:["完遂力","ルーティン作業"],j:["企画職","広報","マーケター","カウンセラー","起業家","ブランドストラテジスト"],bp:["INTJ","INFJ","ENTJ"],wm:"ISTJ"},
  ENTP:{d:"既存の仕組みの非合理性を見抜き、壊して再構築する改革者。問題の本質を誰よりも早く見抜き、鮮やかな切り口で解決策を提示する。ディベート力は全タイプ随一で、複雑な利害関係者間の議論でも的確に論点を整理し合意形成に導く。",str:["革新力","ディベート力","問題の本質を見抜く力","戦略的思考"],weak:["ルーティンの継続","感情面のケア"],j:["コンサルタント","弁護士","起業家","プロダクトマネージャー","記者","ベンチャーキャピタリスト"],bp:["INFJ","INTJ","ENFJ"],wm:"ISFJ"},
  ESTJ:{d:"組織の柱としてプロジェクトを確実にゴールまで導く統率者。明確なルールと期限を設定し、全メンバーが迷わず動ける仕組みを構築する。プロジェクト管理のプロフェッショナルで、複数のタスクを同時進行で的確にコントロールする能力に長ける。",str:["管理能力","実行力","組織構築","進捗管理"],weak:["柔軟な対応","メンバーの感情面への配慮"],j:["プロジェクトマネージャー","管理職","経営者","裁判官","軍人","経営コンサルタント"],bp:["ISFP","ISTP","INFP"],wm:"INFP"},
  ESFJ:{d:"チーム全体の調和と雰囲気を守るガーディアン。メンバー一人ひとりの状態を把握し、モチベーションが下がっている人にはタイムリーなケアを提供する。採用面接やオンボーディングでの人を見る目は確かで、チームカルチャーの醸成と維持に不可欠な存在。",str:["チームケア","調整力","信頼構築","採用・オンボーディング"],weak:["厳しいフィードバック","批判への耐性"],j:["人事","教師","看護師","広報","ホテルマネージャー","カスタマーサクセス"],bp:["ISFP","ISTP","INFP"],wm:"INTP"},
  ENFJ:{d:"人を育てる天才。1on1やメンタリングの場面では全タイプ中最も効果的なコーチングを提供し、メンバーの自信と能力を驚くほど短期間で引き上げる。ビジョンを語る説得力と、個々の事情に寄り添う共感力の両方を兼ね備えた理想的なピープルマネージャー。",str:["リーダーシップ","人材育成","プレゼン","共感型マネジメント"],weak:["自己犠牲的傾向","完璧主義"],j:["教育者","HRマネージャー","コーチ","広報","政治家","NGO代表"],bp:["INFP","INTP","ISFP"],wm:"ISTP"},
  ENTJ:{d:"組織のCEOポジションに最も適性がある天性の経営者気質。ビジョン策定→戦略立案→実行→検証のサイクルを高速で回し、組織を着実にゴールに導く。困難な決断も躊躇なく下すことができ、変革期のリーダーシップで圧倒的な成果を上げる。",str:["決断力","統率力","戦略思考","変革推進"],weak:["感情面への配慮","ディテールの確認"],j:["経営者","戦略コンサルタント","投資家","弁護士","事業責任者","ベンチャー経営者"],bp:["INFP","INTP","ENFP"],wm:"ISFP"}
};

const TR = {ISTJ:"品質管理・規律整備",ISFJ:"チームケア・安定サポート",INFJ:"ビジョン策定・1on1コーチ",INTJ:"戦略立案・システム最適化",ISTP:"トラブルシューティング",ISFP:"クリエイティブ・感性デザイン",INFP:"価値観の言語化・文化醸成",INTP:"技術研究・論理的問題解析",ESTP:"営業突破・現場推進",ESFP:"プレゼン・チーム活性化",ENFP:"企画ブレスト・カルチャー構築",ENTP:"イノベーション・制度改革",ESTJ:"プロジェクト統制・進捗管理",ESFJ:"チーム調和・採用オンボーディング",ENFJ:"人材育成・メンタリング",ENTJ:"経営判断・組織牽引"};

const QT = {ISTJ:["「前例はあるの？」","「期限は守るもの」","「マニュアルに書いてある」","「データで示して」"],ISFJ:["「大丈夫？何か手伝おうか」","「去年の今頃は…」","「みんなが笑顔ならそれでいい」"],INFJ:["「なんとなくそうなる気がしてた」","「本当にそれでいいの？」","「人は変われると信じてる」"],INTJ:["「非効率すぎる、改善しよう」","「3手先まで読んでる」","「感情論はやめてくれ」"],ISTP:["「とりあえずバラしてみよう」","「触らせて」","「別に」","「やってみればわかる」"],ISFP:["「自分のペースでやらせて」","「言葉にするの難しいんだけど…」","「きれい…」"],INFP:["「それって本当に正しいの？」","「理想を捨てたくない」","「何かが違う気がする」"],INTP:["「面白い仮説を思いついた」","「まず定義を明確にしよう」","「論理的におかしい」"],ESTP:["「考えてないで動けば？」","「人生一回きりだろ」","「やってから考えよう」"],ESFP:["「楽しくなきゃ意味ない！」","「今を生きよう！」","「なんとかなるって」"],ENFP:["「聞いて聞いて！すごいこと思いついた！」","「可能性は無限大」","「面白そう、やってみよう！」"],ENTP:["「反例があるんだけど」","「常識を疑え」","「それ、本当にベスト？」"],ESTJ:["「結論から言って」","「期限と担当者を決めよう」","「ルールはルール」"],ESFJ:["「ご飯ちゃんと食べた？」","「みんなの意見も聞いてみよう」","「調和が大事」"],ENFJ:["「君ならきっとできる」","「もっと成長できるよ」","「一緒に頑張ろう」"],ENTJ:["「ゴールは何？」","「最適解を出せ」","「時間がないぞ」"]};

const BP = {INTJ:["ENFP","ENTP"],INTP:["ENTJ","ENFJ"],INFJ:["ENFP","ENTP"],INFP:["ENFJ","ENTJ"],ISTJ:["ESFP","ESTP"],ISFJ:["ESFP","ESTP"],ESTJ:["ISFP","ISTP"],ESFJ:["ISFP","ISTP"],ENTJ:["INFP","INTP"],ENFJ:["INFP","ISTP"],ENTP:["INFJ","INTJ"],ENFP:["INFJ","INTJ"],ESTP:["ISFJ","ISTJ"],ESFP:["ISFJ","ISTJ"],ISTP:["ENFJ","ESTJ"],ISFP:["ESTJ","ESFJ"]};

const REL = {IT:{l:"マイペースな天才肌",i:"🧠",c:"#818cf8",d:"論理で世界を解読する孤高の存在。自分の知的世界を持ち、信頼した相手にだけその扉を開く。感情表現は苦手だが忠誠心は絶大。",lv:"感情より行動で示す。信頼を得るまで時間がかかるが一度心を開くと驚くほど一途。",stt:"感情的な要求が続くとシャットダウンし殻に閉じこもる。"},ET:{l:"情熱のカリスマリーダー",i:"🔥",c:"#ef4444",d:"アップテンポで効率第一。チームを引っ張るリーダーシップは本能レベル。勝負の場で最も輝く。",lv:"主導権を握りたいタイプ。好きな人には情熱的に直球アプローチ。",stt:"自分のペースを乱されると一気にフラストレーションが爆発する。"},IF:{l:"穏やかな繊細アーティスト",i:"🌿",c:"#33b98a",d:"繊細な感受性とアーティスティックな内面世界を持つ。平和主義だが価値観の芯は鋼のように強い。",lv:"精神的なつながりを最も重視。言葉より態度や雰囲気で愛情を示す。",stt:"価値観を否定されると深く傷つき、回復に時間がかかる。"},EF:{l:"みんなを照らす太陽",i:"☀️",c:"#e4ae3a",d:"人を笑顔にすることが使命。常に誰かと繋がっていたい社交の星。感情的なつながりが生命線。",lv:"記念日・サプライズに全力投球。同じ熱量のリアクションを期待しがち。",stt:"無視や孤立が最大の恐怖。感謝されないと急速にモチベーションが低下する。"}};
const GE = {SF:{l:"あったかファミリー",i:"🏠",h:"ハッフルパフ",c:"#fbbf24",d:"温かい気配りと安心感に満ちた環境を築く。記念日を大切にし、メンバーの個人的な事情にも心を配る。",w:"チームの潤滑油。細やかな気配りで職場の雰囲気を明るくし、メンバー間の信頼関係を育む。"},ST:{l:"プロフェッショナル集団",i:"💼",h:"スリザリン",c:"#6b7280",d:"整理整頓・効率重視。感情よりもデータと結果で語る実力主義の環境を好む。",w:"数字で成果を示す。マニュアル化・業務改善・品質管理のプロフェッショナル。"},NF:{l:"未来を語る理想家集団",i:"🌈",h:"グリフィンドール",c:"#a78bfa",d:"「世界をより良くする」が合言葉。ビジョンと情熱で仲間を鼓舞し、大きな夢に向かって団結する。",w:"ビジョンと共感力でチームを動かす。メンバーの成長と組織の理念を一致させる架け橋。"},NT:{l:"知的エリート研究室",i:"🔬",h:"レイブンクロー",c:"#3b82f6",d:"「なぜ？」が口癖。知的好奇心の塊が集まり、複雑な問題を理論と分析で解き明かす。",w:"戦略立案・技術革新・問題分析の中核。データと論理で組織の方向性を定める。"}};
const ECO = {ES:{l:"リア充アクティブ派",i:"🏖️",c:"#f97316",d:"フットワークが軽くトレンドに敏感。人が集まる場所にエネルギーを感じ、体験を通じて人生を楽しむ。",q:"沈黙や退屈に耐えられない。常に次の予定を入れていないと不安になる。"},EN:{l:"未来のビジョナリー",i:"🚀",c:"#a855f7",d:"現状維持＝退屈。常に頭の中で新しいアイデアが渋滞を起こしている。可能性の追求が生きがい。",q:"話が突然飛ぶ。3つ先の話題に移動して周囲がついてこれない。"},IS:{l:"穏やかな安心キーパー",i:"🧸",c:"#14b8a6",d:"安定感と穏やかさの象徴。少人数での深い交流を好み、信頼できる人と過ごす静かな時間に幸せを感じる。",q:"褒められると固まる。突然の予定変更が最大のストレス源。"},IN:{l:"内省する哲学者",i:"📚",c:"#818cf8",d:"独自の価値観と哲学を持ち、深く考えること自体に喜びを感じる。内面世界の豊かさは全タイプ随一。",q:"考えすぎて眠れない夜がある。頭の中の対話が止まらない。"}};
const SR = {FP:{l:"価値観ファイター",i:"🎯",c:"#ec4899",d:"自分の価値観と自由を最優先に据える。本質を見抜く直感力があり、嘘や偽りを本能的に見破る。",m:"「それ本当に必要？」と核心を突く。無駄を削ぎ落とし本当に大切なものを浮かび上がらせる。"},FJ:{l:"調和のガーディアン",i:"🤝",c:"#0ea5e9",d:"場の雰囲気を守る調整役。対立を感知すると自然と間に入り、全員が納得する落とし所を見つける。",m:"全員の意見を引き出し、優先順位をつけてまとめ上げる。会議の空気を読むプロ。"},TP:{l:"論理の切れ者",i:"🐺",c:"#f43f5e",d:"合理性を追求する鋭い思考の持ち主。無駄を嫌い、最短ルートで核心にたどり着く。",m:"「で、結論は？」会議のムダを省き、論理の穴を瞬時に指摘。問題解決のスピードが段違い。"},TJ:{l:"目標達成マシーン",i:"⚙️",c:"#64748b",d:"効率と結果を重視し、計画を立て規律を守る。ゴールから逆算して行動する戦略的実行者。",m:"アジェンダ設定、時間管理、ネクストアクションの明確化。会議を成果に直結させる。"}};
const LS = {EJ:{l:"目的達成の推進者",i:"🏆",c:"#eab308",d:"「やると決めたことは必ずやる」が信条。目標に向かって周囲を巻き込む強力な推進力を持つ。",mt:"「決めたらやる。言い訳は聞かない」"},IJ:{l:"確実な道筋の設計者",i:"🗺️",c:"#0891b2",d:"綿密な計画と内面の強さで、確実にゴールにたどり着く。派手さはないが信頼性は抜群。",mt:"「準備がすべて。備えあれば憂いなし」"},EP:{l:"自由な冒険者",i:"🎲",c:"#d946ef",d:"人生の選択は自分で決める。型にはまらない生き方を貫き、予定調和を嫌う自由な精神の持ち主。",mt:"「後悔だけはしたくない。やらない後悔よりやる後悔」"},IP:{l:"静かなる求道者",i:"🧘",c:"#059669",d:"自分の内なる声に従い、信念を貫く。外からの評価より自分自身が納得できるかを重視する。",mt:"「自分に嘘をつかない。それだけは譲れない」"}};
const TAL = {NJ:{l:"パーフェクト型",i:"💎",c:"#7c3aed",s:"高い目標を掲げ、カリスマ性と計画力で組織を牽引する。ビジョンを現実に変える実行力が強み。",sp:"未来予測 — まだ誰も見ていない可能性を先取りする直感力"},SJ:{l:"ディテール型",i:"🔍",c:"#0284c7",s:"現実的で几帳面。ルールとの整合性を保ちながら、コツコツと信頼を積み上げていく堅実さが武器。",sp:"ミス発見 — 他の誰もが見落とす小さなズレを確実に捕捉する眼力"},NP:{l:"イノベーション型",i:"💡",c:"#ea580c",s:"好奇心旺盛で変化を楽しむ。退屈を最も恐れ、常に新しい可能性を追求し続けるイノベーター。",sp:"発想転換 — 行き詰まった状況で全く新しい切り口を見出す閃き"},SP:{l:"パフォーマンス型",i:"⚡",c:"#dc2626",s:"圧倒的な行動力と現実への適応力。瞬間的な判断と実行のスピードで他を圧倒する。",sp:"瞬間対応 — 予想外の事態に即座に反応し最適な行動を取る反射神経"}};
/* --- Helper: get keys --- */
function gk(t) {
  if (!t) return {};
  return {grp:GRP[t],eco:t[0]+t[1],rel:t[0]+t[2],role:t[2]+t[3],life:t[0]+t[3],talent:t[1]+t[3]};
}

/* --- Love Compatibility --- */
function calcLove(t1, t2) {
  if (!t1 || !t2) return null;
  var k1=gk(t1),k2=gk(t2),score=38,pros=[],cons=[],tips=[];
  if ((BP[t1]&&BP[t1].indexOf(t2)>=0)||(BP[t2]&&BP[t2].indexOf(t1)>=0)){score+=28;pros.push("理論上のベストカップル — 互いに足りないものを自然に補い合える黄金の組み合わせ");}
  /* E/I */
  if(t1[0]===t2[0]){score+=6;pros.push("エネルギーの充電スタイルが一致しており、一緒にいて自然体でいられる安心感がある");}
  else{score+=3;
    cons.push("「一人になりたい」vs「一緒にいたい」で温度差が生まれやすい。E型が楽しそうに外出する姿にI型が疎外感を覚えたり、I型が引きこもる姿をE型が拒絶と受け取るケースが多い");
    tips.push("E型は「黙って隣にいる時間」もI型にとっては最高の愛情表現だと理解する。I型は月に数回でも相手の社交イベントに参加する姿勢を見せるだけで関係が劇的に安定する");
  }
  /* S/N */
  if(t1[1]===t2[1]){score+=7;pros.push("世界の見方が近く、日常会話が自然と噛み合い深い対話に発展しやすい");}
  else{score+=4;
    cons.push("S型が「今日の夕飯どうする？」と具体的な話をしたい時にN型が「将来どこに住みたい？」と飛躍した話を始める——この会話のズレが日常的に蓄積してフラストレーションになりやすい");
    tips.push("S型は時々パートナーの夢や理想の話に付き合い、N型は話を具体的なアクションに落とし込む練習をする。「今日は夢の話タイム / 現実の話タイム」と切り替えるルールを作るのも効果的");
  }
  /* T/F — most critical in love */
  if(t1[2]===t2[2]){score+=10;pros.push("愛情表現のスタイルと期待するリアクションが似ているため、気持ちがストレートに伝わる");}
  else{score+=2;
    cons.push("T型が問題解決モードで「こうすればいいのに」とアドバイスすると、F型は「気持ちを理解してほしいだけなのに」と傷つく。逆にF型が感情的になるとT型は「論理的に話してほしい」とシャットダウンしてしまう、という悪循環に陥りやすい");
    tips.push("T型は話を聞く時の最初の5分間は解決策を言わず「それは辛かったね」と共感に徹する訓練を。F型はT型の不器用なアドバイスの裏にある「相手を助けたい」という愛情に目を向ける。「今は聞いてほしいだけ／アドバイスが欲しい」を事前に伝える習慣も非常に有効");
  }
  /* J/P */
  if(t1[3]===t2[3]){score+=8;pros.push("生活リズム・計画の立て方・休日の過ごし方が合い、日常のストレスが少ない");}
  else{score+=2;
    cons.push("J型が「来月の旅行の予約を今日中にしよう」と言う横で、P型が「もっとギリギリでよくない？」と返す——この計画性のギャップが家事分担・金銭管理・子育て方針など生活の幅広い場面で繰り返し衝突の火種になりうる");
    tips.push("J型はP型の「今決めなくてもいい」は怠慢ではなく「もっと良い選択肢が現れるかも」という最適化本能だと理解する。P型はJ型が安心できるよう、大枠の方向性だけでも早めに共有する。家事や金銭管理はJ型がリード、余暇の使い方はP型に委ねるといったゆるやかな分業がおすすめ");
  }
  if(k1.rel===k2.rel){score+=8;pros.push("人との距離感や愛情の示し方が似ており、無理なく心地よい関係を維持できる");}
  else{score+=2;
    cons.push("対人スタイルが異なるため、「愛している証拠」の見せ方に認識のズレが生まれやすい。片方は行動で示し、もう片方は言葉を求める——すれ違いの典型パターン");
    tips.push("「5つの愛の言語（言葉・行動・贈り物・時間・スキンシップ）」のフレームワークを二人で共有し、互いが最も嬉しい愛情表現を明確にしておくと劇的に改善する");
  }
  if(k1.life===k2.life){score+=5;pros.push("人生の中で大切にするものが共通しており、長期的な関係が安定しやすい");}
  if(k1.grp===k2.grp){score+=4;pros.push("趣味や友人グループの傾向が合い、共通の楽しみを見つけやすい");}
  var diff=0;for(var i=0;i<4;i++){if(t1[i]!==t2[i])diff++;}
  if(diff===2){score+=5;pros.push("程よい違いが恋愛にスパイスを加え、長く新鮮さを保てる");}
  else if(diff>=3){score+=2;
    cons.push("認知機能の違いが多く、「普通こうするでしょ？」の『普通』の定義が根本的に違う。無意識の期待のズレが日常的にストレスを生みやすい");
    tips.push("「理解しよう」という姿勢そのものが最大の愛情表現。定期的に二人の時間を確保し、相手の世界観を聞く「デブリーフィング・デート」を習慣にすると、違いを強みに変えていける");
  }
  else{score+=3;}
  score=Math.min(97,Math.max(25,score));
  if(t1===t2){score=75;
    pros=["互いを完全に理解できる鏡のような存在。言葉にしなくても気持ちが通じ合い、価値観の衝突がほぼ起こらない安心感がある"];
    cons=["似すぎてマンネリ化しやすく、関係に新鮮な刺激が不足しがち。互いの弱点も共通しているため、同じ問題に二人ともハマりやすい"];
    tips=["あえて普段やらないジャンルの体験（アウトドア・アート・スポーツ等）を一緒に試す。また、互いの弱点を補うために第三者（友人・メンター）との交流を意識的に増やすと関係がさらに深まる"];
  }
  if(pros.length===0)pros.push("異なる魅力を持つ刺激的なカップル — 互いの世界を広げ合える可能性を秘めている");
  if(cons.length===0)cons.push("価値観の違いを「面白い」と思えるかどうかが関係の長続きの鍵。違いを欠点ではなく多様性として受け入れるマインドセットが大切");
  if(tips.length===0)tips.push("互いの「当たり前」が違うことを前提に、好奇心を持って相手の内面を探索し続ける。定期的に「最近嬉しかったこと・嫌だったこと」を共有する時間を作ると信頼が深まる");
  return {score:score,pros:pros,cons:cons,tips:tips};
}

/* --- Work Compatibility --- */
function calcWork(t1, t2) {
  if (!t1 || !t2) return null;
  var k1=gk(t1),k2=gk(t2),score=40,pros=[],cons=[],tips=[];
  var wb1=WK[t1],wb2=WK[t2];
  if((wb1&&wb1.bp.indexOf(t2)>=0)||(wb2&&wb2.bp.indexOf(t1)>=0)){score+=22;pros.push("仕事上の理想的パートナー — スキルの相互補完で1+1が3以上になる組み合わせ");}
  if((wb1&&wb1.wm===t2)||(wb2&&wb2.wm===t1)){score-=10;
    cons.push("仕事の進め方が根本的に異なり、意識的な歩み寄りがないと生産性が落ちる組み合わせ。互いのやり方に「なぜそうするの？」とストレスを感じやすく、放置すると信頼関係の毀損に繋がる");
    tips.push("ワーストマッチでも役割を明確に分け、互いの領域に口を出さないルールを設けると協働は可能。週1回の短い振り返りMTGで認識を合わせ、摩擦の芽を早期に摘むことが重要");
  }
  /* J/P — deadline culture */
  if(t1[3]===t2[3]){
    if(t1[3]==="J"){score+=12;pros.push("計画・進捗管理の価値観が一致し、プロジェクトの納期遵守が盤石。安定した成果を出し続けられる");}
    else{score+=6;pros.push("柔軟な発想で互いのアイデアを膨らませ、イノベーティブなアウトプットが生まれやすい");
      cons.push("二人ともP型のため、締切管理やタスクの収束が甘くなりがち。「誰かがやるだろう」と思っていたら誰もやっていなかった、というリスクが常にある");
      tips.push("プロジェクト開始時に必ず中間マイルストーンを設定し、二人のうちどちらかが明示的にスケジュール管理役を担う宣言をする。ツール（Trello等）の導入も効果的");
    }
  }else{score+=8;pros.push("J型の緻密な計画力とP型の柔軟な対応力で、想定内・想定外の両方に強いチーム");
    cons.push("J型が「予定通りに進めたい」と思う場面でP型が方向転換を提案し、互いにフラストレーションが溜まることがある。J型は予定変更をストレスに感じ、P型は融通の利かなさにイライラする");
    tips.push("J型がマイルストーンの大枠を設定し、各マイルストーン内の進め方はP型に裁量を委ねる二段階方式が最も効果的。J型は「計画変更＝失敗ではない」、P型は「大枠の期限は守る」を互いのルールに");
  }
  /* T/F — decision making */
  if(t1[2]===t2[2]){
    if(t1[2]==="T"){score+=7;pros.push("論理的な議論でスピーディーに意思決定でき、感情的なバイアスに流されにくい");
      cons.push("二人とも論理重視のため、チームメンバーやクライアントの感情面への配慮が不足しがち。正論だが言い方がキツい、という評価を受けやすい");
      tips.push("フィードバックや提案を行う前に「相手はこれを聞いてどう感じるか」を5秒だけ考える習慣をつける。論理的に正しいことと、伝え方が適切であることは別問題");
    }
    else{score+=6;pros.push("チームの雰囲気やメンバーのモチベーション管理を重視した温かいチーム運営ができる");
      cons.push("二人とも感情面を重視するため、厳しい判断（人事・予算削減・方針転換）を先送りにしがち。「嫌われたくない」が意思決定のボトルネックになるリスク");
      tips.push("データや数字を判断の根拠として明示するルールを設ける。「感情と論理、両方のレンズで見る」チェックリストを作成し、重要な意思決定時に必ず参照する習慣をつけると改善できる");
    }
  }else{score+=9;pros.push("T型の論理的分析とF型の共感的配慮のバランスで、質の高い意思決定ができる");
    cons.push("T型の率直なフィードバックをF型が「冷たい」と感じたり、F型の配慮をT型が「回りくどい」と感じる場面が起きがち。コミュニケーションスタイルの違いが信頼構築の妨げになることもある");
    tips.push("T型はフィードバック時に「まず良い点→改善点→応援」のサンドイッチ構造を意識する。F型は「結論を先に言い、理由を添える」練習をする。互いのスタイルの違いをチーム内で公開的に共有しておくと摩擦が大幅に減る");
  }
  /* E/I — communication style */
  if(t1[0]===t2[0]){
    if(t1[0]==="E"){score+=4;pros.push("プレゼン・交渉の場で圧倒的な推進力を発揮する営業力抜群のコンビ");
      cons.push("「話して考える」二人が集まると会議が長くなり、結論が出ないまま次の話題に移るリスク。深い分析や内省の時間が不足し、表面的な施策に終わりがち");
      tips.push("会議には必ずアジェンダとタイムキーパーを設定。「発散タイム15分→収束タイム10分」のように構造化し、分析が必要な案件は各自で持ち帰って検討する時間を確保する");
    }
    else{score+=4;pros.push("深い分析と集中作業で質の高いアウトプットを安定的に生み出せる");
      cons.push("二人とも対外発信やネットワーキングが苦手なため、チームの成果が組織内外に伝わりにくい。「いい仕事をしているのに評価されない」状況に陥りやすい");
      tips.push("成果の可視化と発信を意識的にタスク化する。週報・月報のフォーマットを作り交代で担当する。可能であればE型のメンバーを巻き込んでプレゼンや社内広報を任せるのもよい");
    }
  }else{score+=7;pros.push("E型が対外折衝・プレゼンを、I型が深い分析・品質管理を担う自然な役割分担が生まれる");
    tips.push("I型は考えがまとまる前でも途中段階を共有することを意識する。E型はI型が集中している時間を中断しない配慮を。非同期コミュニケーション（Slack/ドキュメント）とリアルタイム会話を使い分けるとスムーズ");
  }
  /* S/N — strategy vs execution */
  if(t1[1]===t2[1]){
    if(t1[1]==="N"){score+=4;pros.push("イノベーティブな企画やコンセプトが次々と生まれるクリエイティブなペア");
      cons.push("アイデアは豊富だが実装フェーズの詰めが甘くなりがち。コンセプトの美しさに酔って、実現可能性やコストの検証を後回しにするリスクがある");
      tips.push("アイデア出しと実行計画のフェーズを明確に分ける。「このアイデアを実現するために必要なリソース・期間・コスト」を具体的に洗い出すチェックポイントを必ず設ける。実務力のあるS型メンバーを1人加えると完璧な体制に");
    }
    else{score+=5;pros.push("現場の実務力が高く、確実な遂行力でプロジェクトを着実にゴールまで導ける");
      cons.push("「前例通り」「実績があるやり方」に固執しやすく、市場変化への対応や新規事業の立ち上げが苦手。ゆでガエル現象に陥るリスクがある");
      tips.push("月1回は「そもそもこのやり方は最適か？」を問い直すレビューの機会を作る。他部署や外部のN型人材との勉強会やブレストを定期的に実施し、視野を広げるインプットを意識的に取り入れる");
    }
  }else{score+=8;pros.push("N型がビジョンとコンセプトを描き、S型が着実に実装する理想的な分業体制");
    tips.push("N型はアイデアを出す際に「なぜこれが必要か」を具体例と共に説明する。S型は「それは現実的に無理」と即否定せず、まず可能性を検討してからフィードバックする。この相互リスペクトが黄金コンビの鍵");
  }
  if(k1.talent===k2.talent){score+=2;
    cons.push("同じ才能タイプのため得意領域が被りやすく、成果の差が直接比較されて競争関係に陥るリスクがある。縄張り意識が生まれると協力関係が崩れやすい");
    tips.push("担当領域を明確に分けて「この分野はあなた、この分野は私」と線引きする。互いの専門性の違いを見出して棲み分けを意識するか、完全に異なるプロジェクトにアサインされるのが理想的");
  }
  else{score+=5;pros.push("異なる才能タイプでチームの死角を埋め合い、多角的なアプローチが可能に");}
  if(k1.grp===k2.grp){score+=3;pros.push("仕事の優先順位や価値基準が近く、コミュニケーションコストが低い");}
  score=Math.min(97,Math.max(25,score));
  if(t1===t2){score=70;
    pros=["意思疎通がスムーズで信頼関係を築きやすい — 阿吽の呼吸で動ける。互いの思考プロセスが理解できるため、説明コストが圧倒的に低い"];
    cons=["視点が偏り盲点が生まれやすく、同じミスを二人とも見落とす危険性がある。また、「分かり合えるからこそ」甘えが生じ、成長の刺激が不足しがち"];
    tips=["異なるタイプの第三者をチームに加えることで突破口が開ける。定期的に外部レビュー（他部署の意見、メンターのフィードバック）を取り入れ、自分たちの盲点を意識的にチェックする仕組みを作る"];
  }
  if(pros.length===0)pros.push("異なるスキルセットで幅広い課題に対応でき、互いの弱みをカバーし合える");
  if(cons.length===0)cons.push("仕事の進め方にギャップがあるため、プロジェクト初期段階での擦り合わせが特に重要。暗黙の期待を言語化してすり合わせないと、後半で大きなすれ違いが生じる");
  if(tips.length===0)tips.push("互いの強みリストを共有し、得意分野で明確に分業する。週次で短いチェックインMTG（15分）を設け、進捗と課題を共有する習慣をつけると生産性が劇的に向上する");
  return {score:score,pros:pros,cons:cons,tips:tips};
}

/* --- Team Analysis --- */
function analyzeTeam(members) {
  var traits={E:0,I:0,S:0,N:0,T:0,F:0,J:0,P:0};
  members.forEach(function(m){m.split("").forEach(function(c){if(traits[c]!==undefined)traits[c]++;});});
  var total=members.length||1;var gaps=[];
  if(traits.E/total<0.25)gaps.push({issue:"外向型(E)不足",
    fix:"対外コミュニケーション力と推進力が不足しています。プレゼンテーション、営業交渉、社内外へのアピールが弱くなり、チームの成果が正当に評価されにくいリスクがあります。",
    action:"チーム外への成果発信を意識的にタスク化する。月次レポートの共有、社内LTへの登壇、クライアント向けデモの担当者を明示的にアサインしましょう。",
    suggest:["ESTP","ENFP","ENTJ"]});
  if(traits.I/total<0.25)gaps.push({issue:"内向型(I)不足",
    fix:"深い分析や内省の担い手が少なく、拙速な判断に陥るリスクがあります。議論が活発で盛り上がるものの、「本当にこれで正しいのか」を立ち止まって検証する機能が弱い状態です。",
    action:"重要な意思決定の前に「沈黙の10分間」を設け、各自が紙に意見を書き出すサイレントブレストを導入する。非同期のドキュメントレビューも有効です。",
    suggest:["INTJ","INTP","ISFJ"]});
  if(traits.S/total<0.25)gaps.push({issue:"感覚型(S)不足",
    fix:"実装のディテールや品質管理が甘くなる傾向があります。大きなビジョンは描けるのに実行段階でミスが頻発したり、現実のリソース制約を見落としたりするリスクがあります。",
    action:"プロジェクトの各マイルストーンに品質チェックリストを設ける。要件定義は抽象的な理想だけでなく「具体的に何をいつまでに」の形式に落とし込む習慣を徹底しましょう。",
    suggest:["ISTJ","ESTJ","ISTP"]});
  if(traits.N/total<0.25)gaps.push({issue:"直感型(N)不足",
    fix:"新しいアイデアや中長期ビジョンが出にくく、現状維持に陥りやすい状態です。目の前のタスクは確実にこなせるが、市場の変化や技術トレンドへの対応が遅れ、気づいた時には競合に先を越されるリスクがあります。",
    action:"月1回の「未来ブレスト会議」を設定し、3年後の理想の状態を議論する場を作る。他部署の企画職や外部アドバイザーとの交流機会を積極的に作りましょう。",
    suggest:["ENTP","INFJ","ENFP"]});
  if(traits.T/total<0.25)gaps.push({issue:"思考型(T)不足",
    fix:"論理的な意思決定基盤が弱く、「雰囲気」や「みんなの気持ち」で重要な判断が左右されがちです。データに基づく客観的な評価が不足し、非効率な施策が続いてしまうリスクがあります。",
    action:"KPIとデータダッシュボードを整備し、「数字で語る」文化を意識的に醸成する。意思決定時には必ず「賛成/反対の論理的根拠」を明文化するルールを導入しましょう。",
    suggest:["INTJ","ENTP","ISTP"]});
  if(traits.F/total<0.25)gaps.push({issue:"感情型(F)不足",
    fix:"メンバーの感情面のケアが不足し、心理的安全性が損なわれやすい状態です。成果を出していても「このチームにいて楽しいか」が置き去りにされ、モチベーション低下や離職に繋がるリスクがあります。",
    action:"1on1ミーティングを定期化し、業務だけでなく「最近どう？」という雑談の時間を意識的に確保する。フィードバック時は必ず良い点から伝えるサンドイッチ方式を導入しましょう。",
    suggest:["ESFJ","ENFJ","ISFP"]});
  if(traits.J/total<0.25)gaps.push({issue:"判断型(J)不足",
    fix:"計画と締切管理の甘さがプロジェクト進行の最大のボトルネックになっています。アイデアは出るがまとまらない、タスクが増えるが完了しない、優先順位が曖昧なままズルズル進む——という状態に陥りやすいです。",
    action:"プロジェクト管理ツール（Trello/Asana等）を必ず導入し、タスクの担当者・期限・ステータスを可視化する。週次の進捗レビューを欠かさず実施し、優先順位の再整理を習慣化しましょう。",
    suggest:["ESTJ","ISTJ","ENTJ"]});
  if(traits.P/total<0.25)gaps.push({issue:"知覚型(P)不足",
    fix:"変化への適応力が低く、想定外の事態に柔軟に対応できない状態です。計画通りに進めることには長けていますが、前提条件が変わった時に方針転換が遅れ、機会損失に繋がるリスクがあります。",
    action:"計画にあえて「バッファ枠」を設け、想定外に対応できる余白を確保する。四半期ごとに「このまま進めて本当にいいのか」を検証するリトロスペクティブを実施しましょう。",
    suggest:["ENFP","ESTP","INTP"]});
  return {traits:traits,gaps:gaps,total:total};
}

/* ═══════════════════════════════════════════════
   AVATAR COMPONENT
   ═══════════════════════════════════════════════ */
function CssAvatar({type,size}) {
  var z = size || 60;
  var d = AVD[type];
  if (!d) return null;
  var gc = GC[GRP[type]];
  var isE = type[0]==="E";
  var isF = type[2]==="F";
  var h = Math.round(z*0.44);
  var e = Math.max(2,Math.round(z*0.04));
  var b = Math.round(z*0.26);
  return (
    <div style={{width:z,height:z,borderRadius:"50%",background:d.bg,position:"relative",overflow:"hidden",flexShrink:0,display:"inline-block"}}>
      <div style={{position:"absolute",bottom:0,left:"50%",transform:"translateX(-50%)",width:h*1.6,height:Math.round(z*0.35),borderRadius:"50% 50% 0 0",background:gc,opacity:0.8}} />
      <div style={{position:"absolute",top:Math.round(z*0.12),left:"50%",transform:"translateX(-50%)",width:h,height:h,borderRadius:"50%",background:d.skin}} />
      <div style={{position:"absolute",top:Math.round(z*0.06),left:"50%",transform:"translateX(-50%)",width:Math.round(h*(isE?1.05:1.1)),height:Math.round(h*(isE?0.55:0.65)),borderRadius:isE?"50% 50% 40% 40%":"45% 45% 30% 30%",background:d.hair}} />
      <div style={{position:"absolute",top:Math.round(z*0.34),left:"50%",transform:"translateX(-50%)",display:"flex",gap:Math.max(3,Math.round(z*0.12))}}>
        <div style={{width:e,height:e,borderRadius:"50%",background:"#1e293b"}} />
        <div style={{width:e,height:e,borderRadius:"50%",background:"#1e293b"}} />
      </div>
      {isF ? (
        <div style={{position:"absolute",top:Math.round(z*0.46),left:"50%",transform:"translateX(-50%)",width:Math.max(6,Math.round(z*0.14)),height:Math.max(3,Math.round(z*0.04)),borderRadius:"0 0 50% 50%",borderBottom:"1.5px solid #94a3b8"}} />
      ) : (
        <div style={{position:"absolute",top:Math.round(z*0.46),left:"50%",transform:"translateX(-50%)",width:Math.max(6,Math.round(z*0.14)),height:0,borderBottom:"1.5px solid #94a3b8"}} />
      )}
      <div style={{position:"absolute",top:Math.round(z*0.02),right:Math.round(z*0.02),width:b,height:b,borderRadius:"50%",background:d.bg,border:"1.5px solid "+gc,display:"flex",alignItems:"center",justifyContent:"center",fontSize:Math.max(8,Math.round(z*0.16)),lineHeight:1,color:gc}}>
        {d.item}
      </div>
    </div>
  );
}

function Avatar({type,size}) {
  if (!type) return null;
  var z = size || 60;
  var st = useState(0);
  var status = st[0], setStatus = st[1];
  var url = AV_URL[type];
  useEffect(function(){ setStatus(0); }, [type]);
  if (!url || status === 2) return <CssAvatar type={type} size={z} />;
  return (
    <div style={{width:z,height:z,flexShrink:0,display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative"}}>
      {status === 0 ? <div style={{position:"absolute",inset:0}}><CssAvatar type={type} size={z} /></div> : null}
      <img
        src={url} alt={type} width={z} height={z}
        style={{display:status===1?"block":"none",borderRadius:"50%",objectFit:"cover"}}
        onLoad={function(){ setStatus(1); }}
        onError={function(){ setStatus(2); }}
      />
    </div>
  );
}
/* ═══════════════════════════════════════════════
   DESIGN SYSTEM — Editorial Luxury
   ═══════════════════════════════════════════════ */
var S = {
  bg:"#0a0a0f", bg2:"#12121a", bg3:"#1a1a28",
  card:"rgba(255,255,255,0.03)", cardHover:"rgba(255,255,255,0.06)",
  glass:"rgba(255,255,255,0.04)", border:"rgba(255,255,255,0.06)",
  tx:"#e8e4f0", dm:"#8b8698", accent:"#9b6dff",
  gradient:"linear-gradient(135deg,#9b6dff 0%,#e46dff 50%,#6db8ff 100%)"
};

/* --- Glassmorphism Card --- */
function Card({title,icon,color,children,delay,large}) {
  var c = color || S.accent;
  return (
    <div style={{
      background:S.card, backdropFilter:"blur(20px)",
      borderRadius:large?20:16, border:"1px solid "+S.border,
      padding:large?"28px 24px":"20px 18px", marginBottom:large?20:14,
      animation:"fadeUp 0.5s ease both", animationDelay:(delay||0)*0.08+"s",
      position:"relative", overflow:"hidden"
    }}>
      <div style={{position:"absolute",top:0,left:0,right:0,height:2,background:"linear-gradient(90deg,transparent,"+c+",transparent)",opacity:0.5}} />
      {title ? (
        <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:large?16:12}}>
          {icon ? <span style={{fontSize:large?22:18,filter:"saturate(1.2)"}}>{icon}</span> : null}
          <h3 style={{margin:0,fontFamily:F.b,fontWeight:700,fontSize:large?16:13,color:S.tx,letterSpacing:"0.02em"}}>{title}</h3>
        </div>
      ) : null}
      {children}
    </div>
  );
}

/* --- Pill Badge --- */
function Pill({text,color,glow}) {
  var c = color || S.accent;
  return (
    <span style={{
      display:"inline-block",padding:"4px 12px",borderRadius:20,fontSize:10,fontWeight:600,
      fontFamily:F.b,letterSpacing:"0.04em",
      background:glow ? "linear-gradient(135deg,"+c+"22,"+c+"11)" : c+"15",
      color:c, border:"1px solid "+c+"30",
      boxShadow:glow ? "0 0 12px "+c+"20" : "none"
    }}>{text}</span>
  );
}

/* --- Score Ring --- */
function ScoreRing({score,size,color,label}) {
  var sz = size || 100, r = sz*0.38, circ = 2*Math.PI*r;
  var c = color || (score>=75?"#33b98a":score>=55?"#e4ae3a":score>=40?"#f97316":"#ef4444");
  return (
    <div style={{textAlign:"center"}}>
      <svg width={sz} height={sz} style={{filter:"drop-shadow(0 0 12px "+c+"40)"}}>
        <circle cx={sz/2} cy={sz/2} r={r} fill="none" stroke={c+"15"} strokeWidth={sz*0.06} />
        <circle cx={sz/2} cy={sz/2} r={r} fill="none" stroke={c} strokeWidth={sz*0.06}
          strokeDasharray={circ} strokeDashoffset={circ*(1-score/100)}
          strokeLinecap="round" transform={"rotate(-90 "+sz/2+" "+sz/2+")"}
          style={{transition:"stroke-dashoffset 1s ease"}} />
        <text x={sz/2} y={sz/2-4} textAnchor="middle" dominantBaseline="middle"
          style={{fontFamily:F.h,fontWeight:800,fontSize:sz*0.28,fill:c}}>{score}</text>
        <text x={sz/2} y={sz/2+sz*0.15} textAnchor="middle"
          style={{fontFamily:F.b,fontWeight:400,fontSize:sz*0.1,fill:S.dm}}>/ 100</text>
      </svg>
      {label ? <p style={{margin:"6px 0 0",fontFamily:F.b,fontSize:10,color:S.dm}}>{label}</p> : null}
    </div>
  );
}

/* --- Bar Chart --- */
function BarChart({items}) {
  return (
    <div style={{display:"flex",flexDirection:"column",gap:8}}>
      {items.map(function(it,i) {
        return (
          <div key={i} style={{animation:"fadeUp 0.4s ease both",animationDelay:i*0.05+"s"}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3}}>
              <span style={{fontFamily:F.b,fontSize:10,color:S.tx,fontWeight:500}}>{it.label}</span>
              <span style={{fontFamily:F.h,fontSize:10,color:it.color||S.accent,fontWeight:700}}>{it.value}%</span>
            </div>
            <div style={{height:6,borderRadius:3,background:S.glass,overflow:"hidden"}}>
              <div style={{
                height:"100%",borderRadius:3,width:it.value+"%",
                background:"linear-gradient(90deg,"+( it.color||S.accent)+"cc,"+(it.color||S.accent)+")",
                transition:"width 0.8s ease",boxShadow:"0 0 8px "+(it.color||S.accent)+"40"
              }} />
            </div>
          </div>
        );
      })}
    </div>
  );
}

/* --- Trait Dimension Bar --- */
function DimBar({left,right,value,leftColor,rightColor}) {
  var isLeft = value < 50;
  return (
    <div style={{marginBottom:10}}>
      <div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}>
        <span style={{fontFamily:F.b,fontSize:10,color:isLeft?leftColor:S.dm,fontWeight:isLeft?700:400}}>{left} {isLeft?Math.round(100-value)+"%":""}</span>
        <span style={{fontFamily:F.b,fontSize:10,color:!isLeft?rightColor:S.dm,fontWeight:!isLeft?700:400}}>{!isLeft?Math.round(value)+"%":""} {right}</span>
      </div>
      <div style={{height:8,borderRadius:4,background:"rgba(255,255,255,0.06)",position:"relative",overflow:"hidden"}}>
        <div style={{position:"absolute",left:0,top:0,bottom:0,width:value+"%",borderRadius:4,
          background:"linear-gradient(90deg,"+leftColor+","+rightColor+")",
          transition:"width 0.6s ease"}} />
        <div style={{position:"absolute",left:"calc("+value+"% - 2px)",top:-1,width:5,height:10,borderRadius:3,background:"#fff",boxShadow:"0 0 6px rgba(255,255,255,0.5)"}} />
      </div>
    </div>
  );
}

/* --- Section Divider --- */
function Divider({text}) {
  return (
    <div style={{display:"flex",alignItems:"center",gap:12,margin:"20px 0 14px"}}>
      <div style={{flex:1,height:1,background:S.border}} />
      {text ? <span style={{fontFamily:F.b,fontSize:9,color:S.dm,letterSpacing:"0.15em",textTransform:"uppercase",flexShrink:0}}>{text}</span> : null}
      <div style={{flex:1,height:1,background:S.border}} />
    </div>
  );
}

/* --- Quote Block --- */
function Quote({text}) {
  return (
    <div style={{borderLeft:"3px solid "+S.accent,paddingLeft:14,margin:"12px 0",position:"relative"}}>
      <span style={{position:"absolute",top:-8,left:-2,fontSize:28,color:S.accent+"40",fontFamily:"Georgia",lineHeight:1}}>"</span>
      <p style={{fontFamily:F.b,fontSize:11,color:S.dm,lineHeight:1.8,margin:0,fontStyle:"italic"}}>{text}</p>
    </div>
  );
}

/* --- Info Grid --- */
function InfoGrid({items,columns}) {
  return (
    <div style={{display:"grid",gridTemplateColumns:"repeat("+(columns||2)+",1fr)",gap:8}}>
      {items.map(function(it,i) {
        return (
          <div key={i} style={{
            padding:"12px 10px",borderRadius:12,
            background:"linear-gradient(135deg,"+(it.color||S.accent)+"08,"+(it.color||S.accent)+"04)",
            border:"1px solid "+(it.color||S.accent)+"15",
            animation:"fadeUp 0.4s ease both",animationDelay:i*0.06+"s"
          }}>
            {it.icon ? <span style={{fontSize:14,display:"block",marginBottom:4}}>{it.icon}</span> : null}
            <p style={{fontFamily:F.b,fontSize:9,color:it.color||S.accent,fontWeight:700,margin:"0 0 3px",letterSpacing:"0.03em"}}>{it.label}</p>
            <p style={{fontFamily:F.b,fontSize:10,color:S.tx,margin:0,lineHeight:1.6}}>{it.value}</p>
          </div>
        );
      })}
    </div>
  );
}

/* --- Compat Result --- */
function CompatResult({data,t1,t2,mode}) {
  if (!data) return null;
  var isLove = mode === "love";
  return (
    <div style={{animation:"fadeUp 0.5s ease both"}}>
      <div style={{display:"flex",alignItems:"center",justifyContent:"center",gap:16,margin:"16px 0"}}>
        <Avatar type={t1} size={64} />
        <div style={{display:"flex",flexDirection:"column",alignItems:"center"}}>
          <span style={{fontSize:24}}>{isLove ? "💕" : "🤝"}</span>
          <span style={{fontFamily:F.h,fontSize:10,color:S.dm,marginTop:2}}>{isLove?"Love":"Work"}</span>
        </div>
        <Avatar type={t2} size={64} />
      </div>
      <div style={{display:"flex",justifyContent:"center",marginBottom:16}}>
        <ScoreRing score={data.score} size={110} label={isLove?"恋愛相性スコア":"仕事相性スコア"} />
      </div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10}}>
        <div style={{padding:12,borderRadius:12,background:"rgba(51,185,138,0.05)",border:"1px solid rgba(51,185,138,0.12)"}}>
          <p style={{fontFamily:F.b,fontSize:10,color:"#33b98a",fontWeight:800,margin:"0 0 8px",letterSpacing:"0.05em"}}>✦ 強み</p>
          {data.pros.map(function(p,i){return <p key={i} style={{fontFamily:F.b,color:"#a7f3d0",fontSize:10,margin:"0 0 6px",lineHeight:1.7}}>{p}</p>;})}
        </div>
        <div style={{padding:12,borderRadius:12,background:"rgba(249,115,22,0.05)",border:"1px solid rgba(249,115,22,0.12)"}}>
          <p style={{fontFamily:F.b,fontSize:10,color:"#fb923c",fontWeight:800,margin:"0 0 8px",letterSpacing:"0.05em"}}>⚡ 注意点</p>
          {data.cons.map(function(c,i){return <p key={i} style={{fontFamily:F.b,color:"#fed7aa",fontSize:10,margin:"0 0 6px",lineHeight:1.7}}>{c}</p>;})}
        </div>
        <div style={{padding:12,borderRadius:12,background:"rgba(155,109,255,0.05)",border:"1px solid rgba(155,109,255,0.12)"}}>
          <p style={{fontFamily:F.b,fontSize:10,color:"#9b6dff",fontWeight:800,margin:"0 0 8px",letterSpacing:"0.05em"}}>💡 Tips</p>
          {data.tips.map(function(t,i){return <p key={i} style={{fontFamily:F.b,color:"#c4b5fd",fontSize:10,margin:"0 0 6px",lineHeight:1.7}}>{t}</p>;})}
        </div>
      </div>
    </div>
  );
}
/* ═══════════════════════════════════════════════
   TYPE GRID
   ═══════════════════════════════════════════════ */
var GRPS = [{types:["INTJ","INTP","ENTJ","ENTP"],name:"分析家",color:"#9b6dff"},{types:["INFJ","INFP","ENFJ","ENFP"],name:"外交官",color:"#33b98a"},{types:["ISTJ","ISFJ","ESTJ","ESFJ"],name:"番人",color:"#4298b4"},{types:["ISTP","ISFP","ESTP","ESFP"],name:"探検家",color:"#e4ae3a"}];

function TypeGrid({value,onChange,label,compact}) {
  return (
    <div>
      {label ? <p style={{fontFamily:F.b,fontSize:11,color:S.dm,margin:"0 0 10px",fontWeight:500}}>{label}</p> : null}
      <div style={{display:"flex",flexDirection:"column",gap:compact?6:10}}>
        {GRPS.map(function(g) {
          return (
            <div key={g.name}>
              <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:compact?3:5}}>
                <div style={{width:8,height:8,borderRadius:2,background:g.color}} />
                <span style={{fontFamily:F.b,fontSize:9,color:g.color,fontWeight:700,letterSpacing:"0.08em"}}>{g.name}</span>
              </div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:compact?4:6}}>
                {g.types.map(function(t) {
                  var sel = value === t;
                  return (
                    <button key={t} onClick={function(){onChange(sel?"":t);}}
                      style={{
                        all:"unset",cursor:"pointer",textAlign:"center",
                        padding:compact?"6px 2px":"10px 4px",borderRadius:compact?8:12,
                        background:sel?"linear-gradient(135deg,"+g.color+"30,"+g.color+"15)":S.glass,
                        border:sel?"1.5px solid "+g.color+"80":"1px solid "+S.border,
                        transition:"all 0.25s ease",
                        boxShadow:sel?"0 0 20px "+g.color+"25":"none",
                        transform:sel?"scale(1.02)":"scale(1)"
                      }}>
                      <div style={{display:"flex",justifyContent:"center",marginBottom:compact?2:4}}>
                        <Avatar type={t} size={compact?28:36} />
                      </div>
                      <p style={{fontFamily:F.h,fontSize:compact?9:11,fontWeight:sel?800:600,color:sel?g.color:S.dm,margin:0,letterSpacing:"0.05em"}}>{t}</p>
                      {compact ? null : <p style={{fontFamily:F.b,fontSize:8,color:sel?g.color+"cc":S.dm+"88",margin:"2px 0 0"}}>{NICK[t]}</p>}
                    </button>
                  );
                })}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
}

/* ═══════════════════════════════════════════════
   TAB: ANALYSIS (分析)
   ═══════════════════════════════════════════════ */
function AnalysisTab({type}) {
  if (!type) return <EmptyState text="MBTIタイプを選択してください" />;
  var k = gk(type), gc = GC[GRP[type]];
  var relData = REL[k.rel], ecoData = ECO[k.eco], srData = SR[k.role], lsData = LS[k.life], talData = TAL[k.talent], geData = GE[k.eco[1]+k.role[0]];
  var dims = [
    {l:"外向 E",r:"内向 I",v:type[0]==="E"?30:70,lc:"#f97316",rc:"#818cf8"},
    {l:"感覚 S",r:"直感 N",v:type[1]==="S"?30:70,lc:"#14b8a6",rc:"#a855f7"},
    {l:"思考 T",r:"感情 F",v:type[2]==="T"?30:70,lc:"#3b82f6",rc:"#ec4899"},
    {l:"判断 J",r:"知覚 P",v:type[3]==="J"?30:70,lc:"#64748b",rc:"#eab308"}
  ];
  return (
    <div>
      {/* Hero */}
      <div style={{
        textAlign:"center",padding:"28px 20px",marginBottom:20,borderRadius:20,position:"relative",overflow:"hidden",
        background:"linear-gradient(180deg,"+gc+"12,"+gc+"04,transparent)"
      }}>
        <div style={{position:"absolute",inset:0,background:"radial-gradient(ellipse at 50% 0%,"+gc+"20,transparent 70%)"}} />
        <div style={{position:"relative",zIndex:1}}>
          <div style={{display:"inline-block",animation:"float 3s ease-in-out infinite"}}><Avatar type={type} size={90} /></div>
          <div style={{marginTop:14}}>
            <span style={{fontFamily:F.h,fontSize:32,fontWeight:900,background:S.gradient,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",letterSpacing:"0.04em"}}>{type}</span>
          </div>
          <p style={{fontFamily:F.b,fontSize:14,color:gc,fontWeight:700,margin:"4px 0 0"}}>{EM[type]} {NICK[type]}</p>
          <div style={{display:"flex",justifyContent:"center",gap:6,marginTop:10,flexWrap:"wrap"}}>
            <Pill text={GRP[type]} color={gc} glow />
            <Pill text={relData ? relData.l : ""} color={relData ? relData.c : gc} />
            <Pill text={talData ? talData.l : ""} color={talData ? talData.c : gc} />
          </div>
        </div>
      </div>

      {/* Profile */}
      <Card title="パーソナリティプロファイル" icon="📖" color={gc} delay={1} large>
        <p style={{fontFamily:F.b,fontSize:12,color:S.tx,lineHeight:2,margin:0}}>{PROF[type]}</p>
        {QT[type] ? (
          <div style={{marginTop:14}}>
            <p style={{fontFamily:F.b,fontSize:9,color:S.dm,margin:"0 0 6px",letterSpacing:"0.1em"}}>口ぐせ</p>
            <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
              {QT[type].map(function(q,i) {
                return <span key={i} style={{fontFamily:F.b,fontSize:10,color:gc,padding:"5px 12px",background:gc+"10",borderRadius:20,border:"1px solid "+gc+"20"}}>{q}</span>;
              })}
            </div>
          </div>
        ) : null}
      </Card>

      {/* 4 Letter Breakdown */}
      <Card title="認知機能の傾向" icon="🧬" color="#818cf8" delay={2}>
        {dims.map(function(d,i) { return <DimBar key={i} left={d.l} right={d.r} value={d.v} leftColor={d.lc} rightColor={d.rc} />; })}
        <Divider text="各レターの詳細" />
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
          {type.split("").map(function(letter,i) {
            var lt = LT[letter];
            if (!lt) return null;
            return (
              <div key={i} style={{padding:10,borderRadius:10,background:lt.c+"08",border:"1px solid "+lt.c+"15"}}>
                <p style={{fontFamily:F.h,fontSize:11,color:lt.c,fontWeight:800,margin:"0 0 4px"}}>{letter}</p>
                <p style={{fontFamily:F.b,fontSize:9,color:lt.c+"cc",fontWeight:600,margin:"0 0 4px"}}>{lt.l}</p>
                <p style={{fontFamily:F.b,fontSize:9,color:S.dm,lineHeight:1.7,margin:0}}>{lt.d}</p>
              </div>
            );
          })}
        </div>
      </Card>

      {/* 2-letter personality blocks */}
      <Card title="パーソナリティの深層分析" icon="🔬" color="#a855f7" delay={3} large>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>
          {[
            {title:"対人スタイル",data:relData,key:"rel"},
            {title:"エネルギー源",data:ecoData,key:"eco"},
            {title:"会議での役割",data:srData,key:"sr"},
            {title:"人生の価値観",data:lsData,key:"ls"},
            {title:"才能タイプ",data:talData,key:"tal"},
            {title:"チーム文化",data:geData,key:"ge"}
          ].map(function(block,i) {
            if (!block.data) return null;
            return (
              <div key={i} style={{padding:12,borderRadius:12,background:block.data.c+"08",border:"1px solid "+block.data.c+"12",animation:"fadeUp 0.4s ease both",animationDelay:i*0.06+"s"}}>
                <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:6}}>
                  <span style={{fontSize:16}}>{block.data.i}</span>
                  <div>
                    <p style={{fontFamily:F.b,fontSize:8,color:S.dm,margin:0,letterSpacing:"0.08em"}}>{block.title}</p>
                    <p style={{fontFamily:F.b,fontSize:11,color:block.data.c,fontWeight:700,margin:0}}>{block.data.l}</p>
                  </div>
                </div>
                <p style={{fontFamily:F.b,fontSize:10,color:S.tx,lineHeight:1.7,margin:"0 0 6px"}}>{block.data.d}</p>
                {block.data.lv ? <p style={{fontFamily:F.b,fontSize:9,color:S.dm,lineHeight:1.6,margin:0,fontStyle:"italic"}}>{block.data.lv || block.data.m || block.data.mt || block.data.s || block.data.w || ""}</p> : null}
                {block.data.sp ? <p style={{fontFamily:F.b,fontSize:9,color:block.data.c+"bb",margin:"4px 0 0",lineHeight:1.5}}>{"✦ "+block.data.sp}</p> : null}
              </div>
            );
          })}
        </div>
      </Card>
    </div>
  );
}

/* ═══════════════════════════════════════════════
   TAB: LOVE (恋愛)
   ═══════════════════════════════════════════════ */
function LoveTab({type}) {
  var pairState = useState("");
  var t2 = pairState[0], setT2 = pairState[1];
  if (!type) return <EmptyState text="まず「分析」タブで自分のタイプを選んでください" />;
  var t1 = type, l1 = LOV[t1], l2 = t2 ? LOV[t2] : null;
  var compat = t2 ? calcLove(t1,t2) : null;
  var k = gk(t1), gc = GC[GRP[t1]], relData = REL[k.rel];

  return (
    <div>
      {/* My Love Style */}
      <Card title={t1+" の恋愛スタイル"} icon="💗" color="#ec4899" delay={0} large>
        <div style={{display:"flex",alignItems:"center",gap:14,marginBottom:14}}>
          <Avatar type={t1} size={56} />
          <div>
            <div style={{display:"flex",gap:6,flexWrap:"wrap",marginBottom:4}}><Pill text={l1.s} color="#ec4899" glow /><Pill text={NICK[t1]} color={gc} /></div>
            <p style={{fontFamily:F.b,fontSize:10,color:S.dm,margin:0}}>{relData ? relData.lv : ""}</p>
          </div>
        </div>
        <p style={{fontFamily:F.b,fontSize:11,color:S.tx,lineHeight:1.9,margin:"0 0 14px"}}>{l1.d}</p>
        <InfoGrid items={[
          {icon:"💝",label:"求めるもの",value:l1.n,color:"#ec4899"},
          {icon:"🎁",label:"与えるもの",value:l1.g,color:"#33b98a"},
          {icon:"⚠️",label:"注意ポイント",value:l1.warn,color:"#f97316"},
          {icon:"💬",label:"ストレス時",value:relData ? relData.stt : "",color:"#818cf8"}
        ]} />
      </Card>

      <Divider text="相性チェック" />

      {/* Partner Selection */}
      <Card title="相手のタイプを選択" icon="🔮" color="#a855f7" delay={1}>
        <TypeGrid value={t2} onChange={setT2} compact />
      </Card>

      {/* Partner's Love Style */}
      {(t2 && l2) ? (
        <Card title={t2+" の恋愛スタイル"} icon="💜" color={GC[GRP[t2]]} delay={2}>
          <div style={{display:"flex",alignItems:"center",gap:14,marginBottom:10}}>
            <Avatar type={t2} size={50} />
            <div>
              <Pill text={l2.s} color="#a855f7" glow />
              <p style={{fontFamily:F.b,fontSize:10,color:S.dm,margin:"4px 0 0"}}>{NICK[t2]}</p>
            </div>
          </div>
          <p style={{fontFamily:F.b,fontSize:11,color:S.tx,lineHeight:1.9,margin:"0 0 10px"}}>{l2.d}</p>
          <InfoGrid items={[
            {icon:"💝",label:"求めるもの",value:l2.n,color:"#ec4899"},
            {icon:"🎁",label:"与えるもの",value:l2.g,color:"#33b98a"}
          ]} />
        </Card>
      ) : null}

      {/* Compatibility */}
      {compat ? (
        <Card title={t1+" × "+t2+" 恋愛相性"} icon="💕" color={compat.score>=70?"#33b98a":"#e4ae3a"} delay={3} large>
          <CompatResult data={compat} t1={t1} t2={t2} mode="love" />
          {BP[t1] ? (
            <div style={{marginTop:14,padding:12,borderRadius:12,background:"rgba(236,72,153,0.05)",border:"1px solid rgba(236,72,153,0.12)"}}>
              <p style={{fontFamily:F.b,fontSize:9,color:"#ec4899",fontWeight:700,margin:"0 0 6px"}}>💘 {t1}のベストパートナー</p>
              <div style={{display:"flex",gap:8}}>
                {BP[t1].map(function(bp){
                  return <div key={bp} style={{display:"flex",alignItems:"center",gap:6,padding:"4px 10px",borderRadius:16,background:"rgba(236,72,153,0.08)"}}>
                    <Avatar type={bp} size={22} /><span style={{fontFamily:F.h,fontSize:10,color:"#f9a8d4",fontWeight:600}}>{bp} {NICK[bp]}</span>
                  </div>;
                })}
              </div>
            </div>
          ) : null}
        </Card>
      ) : null}
    </div>
  );
}

/* ═══════════════════════════════════════════════
   TAB: WORK (仕事)
   ═══════════════════════════════════════════════ */
function WorkTab({type}) {
  var partnerState = useState("");
  var partner = partnerState[0], setPartner = partnerState[1];
  if (!type) return <EmptyState text="まず「分析」タブで自分のタイプを選んでください" />;
  var k = gk(type), gc = GC[GRP[type]], ws = WK[type], relData = REL[k.rel], talData = TAL[k.talent];
  var wc = partner ? calcWork(type,partner) : null;

  return (
    <div>
      {/* Career Profile */}
      <Card title={NICK[type]+"のキャリアプロファイル"} icon="💼" color="#3b82f6" delay={0} large>
        <div style={{display:"flex",alignItems:"center",gap:14,marginBottom:14}}>
          <Avatar type={type} size={56} />
          <div style={{flex:1}}>
            <div style={{display:"flex",gap:6,flexWrap:"wrap",marginBottom:4}}>
              <Pill text={TR[type]} color="#3b82f6" glow />
              <Pill text={GRP[type]} color={gc} />
            </div>
            <p style={{fontFamily:F.b,fontSize:10,color:S.dm,margin:0}}>才能: {talData ? talData.l : ""}</p>
          </div>
        </div>
        <p style={{fontFamily:F.b,fontSize:11,color:S.tx,lineHeight:1.9,margin:"0 0 14px"}}>{ws.d}</p>

        {/* Strengths & Weaknesses */}
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:14}}>
          <div style={{padding:12,borderRadius:12,background:"rgba(51,185,138,0.05)",border:"1px solid rgba(51,185,138,0.12)"}}>
            <p style={{fontFamily:F.b,fontSize:9,color:"#33b98a",fontWeight:800,margin:"0 0 8px",letterSpacing:"0.06em"}}>✦ 強み</p>
            <div style={{display:"flex",flexWrap:"wrap",gap:4}}>
              {ws.str.map(function(s){return <Pill key={s} text={s} color="#33b98a" />;})}
            </div>
          </div>
          <div style={{padding:12,borderRadius:12,background:"rgba(249,115,22,0.05)",border:"1px solid rgba(249,115,22,0.12)"}}>
            <p style={{fontFamily:F.b,fontSize:9,color:"#f97316",fontWeight:800,margin:"0 0 8px",letterSpacing:"0.06em"}}>△ 課題</p>
            <div style={{display:"flex",flexWrap:"wrap",gap:4}}>
              {ws.weak.map(function(w){return <Pill key={w} text={w} color="#f97316" />;})}
            </div>
          </div>
        </div>

        {/* Recommended Jobs */}
        <div style={{padding:12,borderRadius:12,background:"rgba(155,109,255,0.05)",border:"1px solid rgba(155,109,255,0.12)"}}>
          <p style={{fontFamily:F.b,fontSize:9,color:"#9b6dff",fontWeight:800,margin:"0 0 8px",letterSpacing:"0.06em"}}>🎯 適職</p>
          <div style={{display:"flex",flexWrap:"wrap",gap:5}}>
            {ws.j.map(function(j){return <Pill key={j} text={j} color="#9b6dff" />;})}
          </div>
        </div>
      </Card>

      {/* Work Style Cards */}
      <Card title="仕事のスタイルと特性" icon="⚡" color="#e4ae3a" delay={1}>
        <InfoGrid items={[
          {icon:relData?relData.i:"",label:"対人スタイル",value:relData?relData.d:"",color:relData?relData.c:""},
          {icon:talData?talData.i:"",label:"才能タイプ",value:talData?talData.s:"",color:talData?talData.c:""},
          {icon:"😤",label:"ストレス要因",value:relData?relData.stt:"",color:"#ef4444"},
          {icon:"😓",label:"苦手な相手",value:ws.wm+" "+NICK[ws.wm]+" — 根本的にアプローチが異なるため摩擦が起きやすい",color:"#f97316"}
        ]} />
      </Card>

      <Divider text="仕事相性チェック" />

      {/* Partner Selection */}
      <Card title="同僚・上司のタイプを選択" icon="🤝" color="#0ea5e9" delay={2}>
        <TypeGrid value={partner} onChange={setPartner} compact />
      </Card>

      {/* Work Compatibility */}
      {wc ? (
        <Card title={type+" × "+partner+" 仕事相性"} icon="📊" color={wc.score>=70?"#33b98a":"#e4ae3a"} delay={3} large>
          <CompatResult data={wc} t1={type} t2={partner} mode="work" />
        </Card>
      ) : null}
    </div>
  );
}

/* ═══════════════════════════════════════════════
   TAB: TEAM (チーム)
   ═══════════════════════════════════════════════ */
function TeamTab() {
  var membersState = useState([]);
  var members = membersState[0], setMembers = membersState[1];
  var analysis = members.length >= 2 ? analyzeTeam(members) : null;

  function toggleMember(t) {
    setMembers(function(prev) {
      return prev.indexOf(t) >= 0 ? prev.filter(function(x){return x!==t;}) : prev.concat([t]);
    });
  }

  return (
    <div>
      <Card title="チームメンバーを選択" icon="👥" color="#0ea5e9" delay={0} large>
        <p style={{fontFamily:F.b,fontSize:10,color:S.dm,margin:"0 0 12px"}}>2名以上を選択するとチーム分析が始まります（複数選択可）</p>
        {GRPS.map(function(g) {
          return (
            <div key={g.name} style={{marginBottom:10}}>
              <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}>
                <div style={{width:8,height:8,borderRadius:2,background:g.color}} />
                <span style={{fontFamily:F.b,fontSize:9,color:g.color,fontWeight:700}}>{g.name}</span>
              </div>
              <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:5}}>
                {g.types.map(function(t) {
                  var sel = members.indexOf(t) >= 0;
                  return (
                    <button key={t} onClick={function(){toggleMember(t);}}
                      style={{
                        all:"unset",cursor:"pointer",textAlign:"center",padding:"8px 4px",borderRadius:10,
                        background:sel?g.color+"20":S.glass, border:sel?"1.5px solid "+g.color+"70":"1px solid "+S.border,
                        transition:"all 0.2s", boxShadow:sel?"0 0 12px "+g.color+"20":"none"
                      }}>
                      <Avatar type={t} size={30} />
                      <p style={{fontFamily:F.h,fontSize:9,color:sel?g.color:S.dm,fontWeight:sel?700:500,margin:"3px 0 0"}}>{t}</p>
                    </button>
                  );
                })}
              </div>
            </div>
          );
        })}
        {members.length > 0 ? (
          <div style={{marginTop:10,display:"flex",flexWrap:"wrap",gap:6,alignItems:"center"}}>
            <span style={{fontFamily:F.b,fontSize:9,color:S.dm}}>選択中:</span>
            {members.map(function(m) {
              return <span key={m} style={{fontFamily:F.h,fontSize:10,color:GC[GRP[m]],padding:"3px 10px",borderRadius:12,background:GC[GRP[m]]+"15",border:"1px solid "+GC[GRP[m]]+"30",fontWeight:600}}>{EM[m]} {m}</span>;
            })}
          </div>
        ) : null}
      </Card>

      {analysis ? (
        <div>
          <Card title="チーム構成バランス" icon="📊" color="#9b6dff" delay={1} large>
            <p style={{fontFamily:F.b,fontSize:10,color:S.dm,margin:"0 0 12px"}}>メンバー {analysis.total}名 の認知機能分布</p>
            <BarChart items={[
              {label:"E 外向型",value:Math.round(analysis.traits.E/analysis.total*100),color:"#f97316"},
              {label:"I 内向型",value:Math.round(analysis.traits.I/analysis.total*100),color:"#818cf8"},
              {label:"S 感覚型",value:Math.round(analysis.traits.S/analysis.total*100),color:"#14b8a6"},
              {label:"N 直感型",value:Math.round(analysis.traits.N/analysis.total*100),color:"#a855f7"},
              {label:"T 思考型",value:Math.round(analysis.traits.T/analysis.total*100),color:"#3b82f6"},
              {label:"F 感情型",value:Math.round(analysis.traits.F/analysis.total*100),color:"#ec4899"},
              {label:"J 判断型",value:Math.round(analysis.traits.J/analysis.total*100),color:"#64748b"},
              {label:"P 知覚型",value:Math.round(analysis.traits.P/analysis.total*100),color:"#eab308"}
            ]} />
          </Card>

          {analysis.gaps.length > 0 ? (
            <Card title="チームの改善ポイント" icon="🚨" color="#f97316" delay={2} large>
              {analysis.gaps.map(function(gap,i) {
                return (
                  <div key={i} style={{padding:14,borderRadius:12,background:"rgba(249,115,22,0.04)",border:"1px solid rgba(249,115,22,0.10)",marginBottom:i<analysis.gaps.length-1?10:0}}>
                    <p style={{fontFamily:F.b,fontSize:11,color:"#fb923c",fontWeight:700,margin:"0 0 4px"}}>{gap.issue}</p>
                    <p style={{fontFamily:F.b,fontSize:10,color:S.tx,lineHeight:1.7,margin:"0 0 8px"}}>{gap.fix}</p>
                    {gap.action ? (
                      <div style={{padding:10,borderRadius:8,background:"rgba(51,185,138,0.06)",border:"1px solid rgba(51,185,138,0.12)",marginBottom:10}}>
                        <p style={{fontFamily:F.b,fontSize:9,color:"#33b98a",fontWeight:700,margin:"0 0 3px",letterSpacing:"0.05em"}}>💡 改善アクション</p>
                        <p style={{fontFamily:F.b,fontSize:10,color:"#a7f3d0",lineHeight:1.7,margin:0}}>{gap.action}</p>
                      </div>
                    ) : null}
                    <p style={{fontFamily:F.b,fontSize:9,color:S.dm,margin:"0 0 6px"}}>補強候補:</p>
                    <div style={{display:"flex",gap:6}}>
                      {gap.suggest.map(function(s) {
                        return <div key={s} style={{display:"flex",alignItems:"center",gap:5,padding:"4px 10px",borderRadius:12,background:GC[GRP[s]]+"12",border:"1px solid "+GC[GRP[s]]+"25"}}>
                          <Avatar type={s} size={20} /><span style={{fontFamily:F.h,fontSize:9,color:GC[GRP[s]],fontWeight:600}}>{s}</span>
                        </div>;
                      })}
                    </div>
                  </div>
                );
              })}
            </Card>
          ) : (
            <Card title="チームバランス良好" icon="✅" color="#33b98a" delay={2}>
              <p style={{fontFamily:F.b,fontSize:11,color:"#a7f3d0",lineHeight:1.7,margin:0}}>全ての認知機能がバランスよく配分されています。多様な視点から物事を捉えられる理想的なチーム構成です。</p>
            </Card>
          )}
        </div>
      ) : null}
    </div>
  );
}

/* --- Empty State --- */
function EmptyState({text}) {
  return (
    <div style={{textAlign:"center",padding:"60px 20px"}}>
      <div style={{fontSize:40,marginBottom:12,opacity:0.3}}>🔍</div>
      <p style={{fontFamily:F.b,fontSize:12,color:S.dm}}>{text}</p>
    </div>
  );
}

/* ═══════════════════════════════════════════════
   MAIN APP
   ═══════════════════════════════════════════════ */
var TABS = [
  {id:"analysis",label:"分析",icon:"🧬",color:"#9b6dff"},
  {id:"love",label:"恋愛",icon:"💕",color:"#ec4899"},
  {id:"work",label:"仕事",icon:"💼",color:"#3b82f6"},
  {id:"team",label:"チーム",icon:"👥",color:"#0ea5e9"}
];

function App() {
  var typeState = useState("");
  var type = typeState[0], setType = typeState[1];
  var tabState = useState("analysis");
  var tab = tabState[0], setTab = tabState[1];

  return (
    <div style={{
      minHeight:"100vh", background:S.bg, color:S.tx, fontFamily:F.b,
      maxWidth:520, margin:"0 auto", position:"relative", overflow:"hidden"
    }}>
      {/* Background effects */}
      <div style={{position:"fixed",top:0,left:"50%",transform:"translateX(-50%)",width:600,height:600,
        background:"radial-gradient(ellipse,#9b6dff08 0%,transparent 70%)",pointerEvents:"none",zIndex:0}} />
      <div style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:500,height:400,
        background:"radial-gradient(ellipse,#33b98a06 0%,transparent 70%)",pointerEvents:"none",zIndex:0}} />

      {/* Header */}
      <div style={{position:"relative",zIndex:1,padding:"24px 20px 0"}}>
        <div style={{textAlign:"center",marginBottom:20}}>
          <p style={{fontFamily:F.h,fontSize:10,color:S.dm,letterSpacing:"0.25em",margin:"0 0 6px",textTransform:"uppercase"}}>Personality Deep Dive</p>
          <h1 style={{
            fontFamily:F.h, fontSize:26, fontWeight:900, margin:0, letterSpacing:"0.02em",
            background:S.gradient, WebkitBackgroundClip:"text", WebkitTextFillColor:"transparent"
          }}>16 Personalities</h1>
          <p style={{fontFamily:F.b,fontSize:10,color:S.dm,margin:"4px 0 0"}}>あなたの性格を深く、美しく読み解く</p>
        </div>

        {/* Tab Bar */}
        <div style={{
          display:"flex",gap:4,padding:4,borderRadius:16,
          background:S.glass, border:"1px solid "+S.border,
          marginBottom:20, backdropFilter:"blur(10px)"
        }}>
          {TABS.map(function(t) {
            var sel = tab === t.id;
            return (
              <button key={t.id} onClick={function(){setTab(t.id);}}
                style={{
                  all:"unset",cursor:"pointer",flex:1,textAlign:"center",padding:"10px 4px",borderRadius:12,
                  background:sel?"linear-gradient(135deg,"+t.color+"25,"+t.color+"10)":"transparent",
                  border:sel?"1px solid "+t.color+"40":"1px solid transparent",
                  transition:"all 0.3s ease",
                  boxShadow:sel?"0 2px 12px "+t.color+"20":"none"
                }}>
                <span style={{fontSize:14,display:"block"}}>{t.icon}</span>
                <span style={{fontFamily:F.b,fontSize:9,color:sel?t.color:S.dm,fontWeight:sel?700:400,display:"block",marginTop:2}}>{t.label}</span>
              </button>
            );
          })}
        </div>

        {/* Type Selection (always visible in analysis tab) */}
        {tab === "analysis" ? (
          <div style={{marginBottom:16}}>
            <TypeGrid value={type} onChange={setType} label="あなたのMBTIタイプを選択" />
          </div>
        ) : null}
      </div>

      {/* Content */}
      <div style={{position:"relative",zIndex:1,padding:"0 20px 40px"}}>
        {tab === "analysis" ? <AnalysisTab type={type} /> : null}
        {tab === "love" ? <LoveTab type={type} /> : null}
        {tab === "work" ? <WorkTab type={type} /> : null}
        {tab === "team" ? <TeamTab /> : null}
      </div>

      {/* Footer */}
      <div style={{textAlign:"center",padding:"20px 0 30px",position:"relative",zIndex:1}}>
        <div style={{width:40,height:1,background:S.border,margin:"0 auto 10px"}} />
        <p style={{fontFamily:F.h,fontSize:8,color:S.dm+"80",letterSpacing:"0.12em"}}>MBTI DEEP DIVE — Personality Analytics</p>
      </div>
    </div>
  );
}


ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>